<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ‰‹åŠ¨éƒ¨ç½²åŸŸå - SSLè¯ä¹¦ç®¡ç†ç³»ç»Ÿ</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }
      .header {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .header h1 {
        margin: 0;
        color: #333;
        font-size: 24px;
      }
      .header p {
        margin: 10px 0 0 0;
        color: #666;
      }
      .domains-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
      }
      .domain-card {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
      }
      .domain-card h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 18px;
      }
      .domain-info {
        margin-bottom: 15px;
      }
      .domain-info span {
        display: inline-block;
        margin-right: 15px;
        color: #666;
      }
      .status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }
      .status.valid {
        background-color: #e8f5e8;
        color: #4caf50;
      }
      .status.expired {
        background-color: #ffebee;
        color: #f44336;
      }
      .status.unknown {
        background-color: #f5f5f5;
        color: #999;
      }
      .actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }
      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        display: inline-block;
        text-align: center;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-primary:hover {
        background-color: #0056b3;
      }
      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background-color: #545b62;
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .empty-state h2 {
        margin-bottom: 10px;
        color: #999;
      }
      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }
      .error {
        background-color: #ffebee;
        color: #f44336;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
      }
      .instructions {
        background-color: #e3f2fd;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }
      .instructions h3 {
        margin-top: 0;
        color: #1976d2;
      }
      .instructions ol {
        margin-bottom: 0;
      }
      .instructions li {
        margin-bottom: 5px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>æ‰‹åŠ¨éƒ¨ç½²åŸŸåç®¡ç†</h1>
        <p>è¿™äº›åŸŸåçš„è¯ä¹¦éœ€è¦æ‰‹åŠ¨ä¸Šä¼ åˆ°CDNå¹³å°ï¼ˆå¦‚ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘CDNç­‰ï¼‰</p>
      </div>

      <div class="instructions">
        <h3>æ‰‹åŠ¨éƒ¨ç½²è¯´æ˜</h3>
        <ol>
          <li>ç‚¹å‡»"ä¸‹è½½è¯ä¹¦"æŒ‰é’®è·å–è¯ä¹¦æ–‡ä»¶</li>
          <li>è§£å‹ç¼©ä¸‹è½½çš„ZIPæ–‡ä»¶</li>
          <li>ç™»å½•åˆ°å¯¹åº”çš„CDNå¹³å°ç®¡ç†åå°</li>
          <li>æ‰¾åˆ°SSLè¯ä¹¦ç®¡ç†é¡µé¢</li>
          <li>ä¸Šä¼ è¯ä¹¦æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯.ceræˆ–.pemæ–‡ä»¶ï¼‰å’Œç§é’¥æ–‡ä»¶ï¼ˆ.keyæ–‡ä»¶ï¼‰</li>
          <li>ç»‘å®šè¯ä¹¦åˆ°ç›¸åº”çš„åŸŸå</li>
          <li>ç­‰å¾…CDNå¹³å°çš„è¯ä¹¦é…ç½®ç”Ÿæ•ˆ</li>
        </ol>
      </div>

      <div id="loading" class="loading">æ­£åœ¨åŠ è½½æ‰‹åŠ¨éƒ¨ç½²åŸŸå...</div>
      <div id="error" class="error" style="display: none"></div>
      <div id="domains-container"></div>
    </div>

    <script>
      // åŠ è½½æ‰‹åŠ¨éƒ¨ç½²åŸŸå
      async function loadManualDomains() {
        try {
          const response = await fetch("/api/certificates/manual");
          const data = await response.json();

          if (data.error) {
            throw new Error(data.error);
          }

          displayDomains(data.domains);
        } catch (error) {
          showError("åŠ è½½æ‰‹åŠ¨éƒ¨ç½²åŸŸåå¤±è´¥: " + error.message);
        } finally {
          hideLoading();
        }
      }

      // æ˜¾ç¤ºåŸŸååˆ—è¡¨
      function displayDomains(domains) {
        const container = document.getElementById("domains-container");

        if (domains.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <h2>ğŸ‰ æ²¡æœ‰éœ€è¦æ‰‹åŠ¨éƒ¨ç½²çš„åŸŸå</h2>
                        <p>æ‰€æœ‰åŸŸåéƒ½å·²é…ç½®ä¸ºè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨</p>
                    </div>
                `;
          return;
        }

        const html = `
                <div class="domains-grid">
                    ${domains
                      .map(
                        (domain) => `
                        <div class="domain-card">
                            <h3>${domain.domain}</h3>
                            <div class="domain-info">
                                <span><strong>çˆ¶åŸŸå:</strong> ${
                                  domain.parent_domain
                                }</span>
                                <span><strong>éƒ¨ç½²æ–¹å¼:</strong> ${
                                  domain.deploy_method
                                }</span>
                            </div>
                            <div class="domain-info">
                                <span><strong>è¯ä¹¦çŠ¶æ€:</strong> <span class="status ${getStatusClass(
                                  domain.status
                                )}">${getStatusText(
                          domain.status
                        )}</span></span>
                            </div>
                            ${
                              domain.expires
                                ? `<div class="domain-info"><span><strong>è¿‡æœŸæ—¶é—´:</strong> ${domain.expires}</span></div>`
                                : ""
                            }
                            <div class="actions">
                                <a href="/api/certificates/manual/${encodeURIComponent(
                                  domain.domain
                                )}/download" 
                                   class="btn btn-primary" 
                                   ${
                                     !domain.cert_exists
                                       ? 'style="opacity: 0.5; pointer-events: none;"'
                                       : ""
                                   }>
                                    ${
                                      domain.cert_exists
                                        ? "ä¸‹è½½è¯ä¹¦"
                                        : "è¯ä¹¦ä¸å­˜åœ¨"
                                    }
                                </a>
                                <button class="btn btn-secondary" onclick="openCDNGuide('${
                                  domain.domain
                                }')">
                                    CDNé…ç½®æŒ‡å—
                                </button>
                            </div>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;

        container.innerHTML = html;
      }

      // è·å–çŠ¶æ€æ ·å¼ç±»
      function getStatusClass(status) {
        switch (status) {
          case "valid":
            return "valid";
          case "expired":
            return "expired";
          default:
            return "unknown";
        }
      }

      // è·å–çŠ¶æ€æ–‡æœ¬
      function getStatusText(status) {
        switch (status) {
          case "valid":
            return "æœ‰æ•ˆ";
          case "expired":
            return "å·²è¿‡æœŸ";
          default:
            return "æœªçŸ¥";
        }
      }

      // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
      }

      // éšè—åŠ è½½æç¤º
      function hideLoading() {
        document.getElementById("loading").style.display = "none";
      }

      // æ‰“å¼€CDNé…ç½®æŒ‡å—
      function openCDNGuide(domain) {
        const guideContent = `
                <h3>CDNé…ç½®æŒ‡å— - ${domain}</h3>
                <h4>ä¸ƒç‰›äº‘é…ç½®æ­¥éª¤ï¼š</h4>
                <ol>
                    <li>ç™»å½•ä¸ƒç‰›äº‘æ§åˆ¶å°</li>
                    <li>è¿›å…¥"CDN" â†’ "åŸŸåç®¡ç†"</li>
                    <li>æ‰¾åˆ°åŸŸå ${domain}</li>
                    <li>ç‚¹å‡»"é…ç½®"è¿›å…¥åŸŸåé…ç½®é¡µé¢</li>
                    <li>åœ¨"HTTPSé…ç½®"ä¸­ç‚¹å‡»"ä¿®æ”¹é…ç½®"</li>
                    <li>ä¸Šä¼ è¯ä¹¦æ–‡ä»¶ï¼ˆ.ceræˆ–.pemï¼‰å’Œç§é’¥æ–‡ä»¶ï¼ˆ.keyï¼‰</li>
                    <li>ç‚¹å‡»"ç¡®è®¤"å®Œæˆé…ç½®</li>
                </ol>
                
                <h4>é˜¿é‡Œäº‘CDNé…ç½®æ­¥éª¤ï¼š</h4>
                <ol>
                    <li>ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°</li>
                    <li>è¿›å…¥"CDN"æœåŠ¡</li>
                    <li>åœ¨"åŸŸåç®¡ç†"ä¸­æ‰¾åˆ°åŸŸå ${domain}</li>
                    <li>ç‚¹å‡»"é…ç½®"</li>
                    <li>åœ¨"HTTPSé…ç½®"ä¸­ç‚¹å‡»"ä¿®æ”¹é…ç½®"</li>
                    <li>é€‰æ‹©"è‡ªå®šä¹‰ä¸Šä¼ "</li>
                    <li>ä¸Šä¼ è¯ä¹¦å†…å®¹å’Œç§é’¥å†…å®¹</li>
                    <li>ç‚¹å‡»"ç¡®å®š"å®Œæˆé…ç½®</li>
                </ol>
            `;

        alert(guideContent.replace(/<[^>]*>/g, "").replace(/&nbsp;/g, " "));
      }

      // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
      document.addEventListener("DOMContentLoaded", function () {
        loadManualDomains();
      });
    </script>
  </body>
</html>
