# CertHub - Enterprise SSL Certificate Automation Platform

<div align="center">

![CertHub Logo](docs/images/certhub-logo.svg)

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/docker-ready-brightgreen.svg)](https://www.docker.com/)
[![ACME](https://img.shields.io/badge/ACME-Let's%20Encrypt-orange.svg)](https://letsencrypt.org/)
[![Version](https://img.shields.io/badge/version-1.2.0-blue.svg)](CHANGELOG.md)
[![Author](https://img.shields.io/badge/author-HKW-orange.svg)](https://github.com/huiyonghkw)

**ä¼ä¸šçº§ SSL/TLS è¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†è§£å†³æ–¹æ¡ˆ**

åŸºäº Docker å®¹å™¨åŒ–ã€ACME åè®®å’Œå¤šäº‘ DNS API çš„è¯ä¹¦å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ç³»ç»Ÿ

</div>

## ğŸ“‹ æ¦‚è¿°

**CertHub** æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ä¼ä¸šçº§ SSL/TLS è¯ä¹¦ç®¡ç†å¹³å°ï¼Œé€šè¿‡ ACME åè®®ï¼ˆLet's Encryptï¼‰å®ç°è¯ä¹¦çš„è‡ªåŠ¨ç”³è¯·ã€éƒ¨ç½²ã€ç»­æœŸå’Œç›‘æ§ã€‚ç³»ç»Ÿé‡‡ç”¨ Docker å®¹å™¨åŒ–æ¶æ„ï¼Œæ”¯æŒé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ç­‰ä¸»æµ DNS æä¾›å•†ï¼Œèƒ½å¤Ÿè½»æ¾ç®¡ç†æ•°ç™¾ä¸ªåŸŸåçš„è¯ä¹¦ç”Ÿå‘½å‘¨æœŸã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **è‡ªåŠ¨åŒ–ç®¡ç†**ï¼šæ¶ˆé™¤æ‰‹åŠ¨è¯ä¹¦ç®¡ç†çš„å¤æ‚æ€§å’Œäººä¸ºé”™è¯¯ï¼ŒèŠ‚çœ 90% çš„è¿ç»´æ—¶é—´
- **å¤šäº‘ç»Ÿä¸€æ¥å…¥**ï¼šæ— ç¼å¯¹æ¥é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ DNS APIï¼Œç»Ÿä¸€ç®¡ç†å¤šäº‘ç¯å¢ƒ
- **å®‰å…¨å¯é **ï¼šé‡‡ç”¨å®Œæ•´è¯ä¹¦é“¾éƒ¨ç½²ï¼Œç¡®ä¿å¾®ä¿¡å°ç¨‹åºã€ç§»åŠ¨åº”ç”¨ç­‰åœºæ™¯çš„å…¼å®¹æ€§
- **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒå¤šæœåŠ¡å™¨æ‰¹é‡éƒ¨ç½²ï¼Œå•ç³»ç»Ÿå¯ç®¡ç† 100+ åŸŸåè¯ä¹¦
- **å®æ—¶ç›‘æ§**ï¼šè‡ªåŠ¨ç›‘æ§è¯ä¹¦çŠ¶æ€ï¼Œæå‰ 30 å¤©å‘é€è¿‡æœŸæé†’ï¼Œé¿å…æœåŠ¡ä¸­æ–­

### ä¸»è¦åŠŸèƒ½

- ğŸ” **è‡ªåŠ¨ç”Ÿæˆ** SSL è¯ä¹¦ï¼ˆå•åŸŸå/æ³›åŸŸåï¼‰
- ğŸš€ **è‡ªåŠ¨éƒ¨ç½²** è¯ä¹¦åˆ°è¿œç¨‹æœåŠ¡å™¨
- ğŸ”„ **è‡ªåŠ¨ç»­æœŸ** å³å°†è¿‡æœŸçš„è¯ä¹¦
- ğŸ“Š **çŠ¶æ€ç›‘æ§** å’Œå‘Šè­¦é€šçŸ¥
- ğŸ›¡ï¸ **å®‰å…¨å¤‡ä»½** å’Œæ¢å¤åŠŸèƒ½
- ğŸŒ **Web ç®¡ç†ç•Œé¢** å’Œ RESTful API
- ğŸ”— **è¯ä¹¦é“¾éªŒè¯** ç¡®ä¿å¾®ä¿¡å°ç¨‹åºå…¼å®¹

### æ”¯æŒçš„åè®®å’ŒæŠ€æœ¯æ ˆ

**æ ¸å¿ƒåè®®**ï¼š

- **ACME v2** - Let's Encrypt è‡ªåŠ¨åŒ–è¯ä¹¦ç®¡ç†åè®®
- **DNS-01 éªŒè¯** - æ”¯æŒæ³›åŸŸåè¯ä¹¦ç”³è¯·
- **SSH/SCP** - å®‰å…¨çš„è¿œç¨‹è¯ä¹¦éƒ¨ç½²
- **REST API** - Web ç®¡ç†ç•Œé¢å’Œè‡ªåŠ¨åŒ–é›†æˆ

**æ”¯æŒçš„ DNS æä¾›å•†**ï¼š

- âœ… é˜¿é‡Œäº‘ DNS (Alibaba Cloud)
- âœ… è…¾è®¯äº‘ DNS (Tencent Cloud)
- âœ… åä¸ºäº‘ DNS (Huawei Cloud)
- ğŸ”„ å¯æ‰©å±•æ”¯æŒæ›´å¤š DNS æœåŠ¡å•†

**è¯ä¹¦ç±»å‹å’ŒåŠ å¯†ç®—æ³•**ï¼š

- **ECC è¯ä¹¦** - æ¤­åœ†æ›²çº¿åŠ å¯†ï¼Œæ€§èƒ½ä¼˜å¼‚ï¼ˆæ¨èï¼‰
- **RSA è¯ä¹¦** - RSA 2048/4096 ä½ï¼Œå…¼å®¹æ€§å¥½ï¼ˆé»˜è®¤ï¼‰
- **å•åŸŸåè¯ä¹¦** - å•ä¸ªåŸŸåç‹¬ç«‹è¯ä¹¦
- **æ³›åŸŸåè¯ä¹¦** - è¦†ç›–æ‰€æœ‰å­åŸŸå (`*.example.com`)

## ğŸ“‘ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#-æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#-æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§è¯¦è§£)
- [æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„ä¸ç»„ä»¶)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [é…ç½®æŒ‡å—](#-é…ç½®æŒ‡å—)
- [ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹)
- [Web ç®¡ç†ç•Œé¢](#-web-ç®¡ç†ç•Œé¢)
- [API æ¥å£](#-api-æ¥å£)
- [å®æˆ˜æ¡ˆä¾‹](#-å®æˆ˜æ¡ˆä¾‹)
- [æ•…éšœæ’é™¤](#-æ•…éšœæ’é™¤)
- [æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)
- [è®¸å¯è¯](#-è®¸å¯è¯)

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§è¯¦è§£

### è¯ä¹¦ç®¡ç†åŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½æ¨¡å—     | å­åŠŸèƒ½       | è¯´æ˜                                  | çŠ¶æ€        |
| ------------ | ------------ | ------------------------------------- | ----------- |
| **è¯ä¹¦ç”³è¯·** | å•åŸŸåè¯ä¹¦   | ä¸ºå•ä¸ªåŸŸåç”³è¯·ç‹¬ç«‹è¯ä¹¦                | âœ… å®Œå…¨æ”¯æŒ |
|              | æ³›åŸŸåè¯ä¹¦   | ä¸€æ¬¡ç”³è¯·è¦†ç›–æ‰€æœ‰å­åŸŸå `*.domain.com` | âœ… å®Œå…¨æ”¯æŒ |
|              | æ‰¹é‡ç”Ÿæˆ     | ä¸€é”®ç”Ÿæˆæ‰€æœ‰é…ç½®çš„è¯ä¹¦                | âœ… å®Œå…¨æ”¯æŒ |
|              | ECC/RSA é€‰æ‹© | æ”¯æŒ ECC å’Œ RSA ä¸¤ç§åŠ å¯†ç®—æ³•          | âœ… å®Œå…¨æ”¯æŒ |
| **è¯ä¹¦éƒ¨ç½²** | SSH è‡ªåŠ¨éƒ¨ç½² | é€šè¿‡ SSH è‡ªåŠ¨éƒ¨ç½²è¯ä¹¦åˆ°è¿œç¨‹æœåŠ¡å™¨     | âœ… å®Œå…¨æ”¯æŒ |
|              | å¤šæœåŠ¡å™¨éƒ¨ç½² | åŒä¸€è¯ä¹¦éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨              | âœ… å®Œå…¨æ”¯æŒ |
|              | è‡ªå®šä¹‰ç›®å½•   | çµæ´»é…ç½®æ¯ä¸ªåŸŸåçš„éƒ¨ç½²ç›®å½•            | âœ… å®Œå…¨æ”¯æŒ |
|              | æ‰‹åŠ¨éƒ¨ç½²æ¨¡å¼ | æ”¯æŒ CDN ç­‰éœ€è¦æ‰‹åŠ¨ä¸Šä¼ çš„åœºæ™¯         | âœ… å®Œå…¨æ”¯æŒ |
|              | è¯ä¹¦é“¾éªŒè¯   | è‡ªåŠ¨éªŒè¯è¯ä¹¦é“¾å®Œæ•´æ€§                  | âœ… å®Œå…¨æ”¯æŒ |
| **è¯ä¹¦ç»­æœŸ** | è‡ªåŠ¨ç»­æœŸ     | åˆ°æœŸå‰ 30 å¤©è‡ªåŠ¨ç»­æœŸ                  | âœ… å®Œå…¨æ”¯æŒ |
|              | æ‰‹åŠ¨ç»­æœŸ     | æ”¯æŒéšæ—¶æ‰‹åŠ¨è§¦å‘ç»­æœŸ                  | âœ… å®Œå…¨æ”¯æŒ |
|              | æ‰¹é‡ç»­æœŸ     | ä¸€é”®ç»­æœŸæ‰€æœ‰å³å°†è¿‡æœŸçš„è¯ä¹¦            | âœ… å®Œå…¨æ”¯æŒ |
| **ç›‘æ§å‘Šè­¦** | çŠ¶æ€ç›‘æ§     | å®æ—¶ç›‘æ§æ‰€æœ‰è¯ä¹¦çŠ¶æ€                  | âœ… å®Œå…¨æ”¯æŒ |
|              | è¿‡æœŸæé†’     | æå‰ 30/15/7/1 å¤©å‘é€æé†’             | âœ… å®Œå…¨æ”¯æŒ |
|              | å¥åº·æ£€æŸ¥     | å®šæœŸæ£€æŸ¥ç³»ç»Ÿè¿è¡ŒçŠ¶æ€                  | âœ… å®Œå…¨æ”¯æŒ |
|              | å¤šæ¸ é“é€šçŸ¥   | é‚®ä»¶/é’‰é’‰/Webhook/Slack               | âœ… å®Œå…¨æ”¯æŒ |
| **Web ç®¡ç†** | ä»ªè¡¨ç›˜       | è¯ä¹¦ç»Ÿè®¡ã€çŠ¶æ€æ¦‚è§ˆ                    | âœ… å®Œå…¨æ”¯æŒ |
|              | è¯ä¹¦ç®¡ç†     | åœ¨çº¿ç”Ÿæˆã€ç»­æœŸã€ä¸‹è½½ã€åˆ é™¤            | âœ… å®Œå…¨æ”¯æŒ |
|              | é…ç½®ç®¡ç†     | åœ¨çº¿ç¼–è¾‘åŸŸåã€DNSã€æœåŠ¡å™¨é…ç½®         | âœ… å®Œå…¨æ”¯æŒ |
|              | æ—¥å¿—æŸ¥çœ‹     | å®æ—¶æŸ¥çœ‹è¯ä¹¦ç®¡ç†æ—¥å¿—                  | âœ… å®Œå…¨æ”¯æŒ |
| **å®‰å…¨åŠŸèƒ½** | å®Œæ•´è¯ä¹¦é“¾   | ç¡®ä¿å¾®ä¿¡å°ç¨‹åºå…¼å®¹                    | âœ… å®Œå…¨æ”¯æŒ |
|              | è‡ªåŠ¨å¤‡ä»½     | éƒ¨ç½²å‰è‡ªåŠ¨å¤‡ä»½æ—§è¯ä¹¦                  | âœ… å®Œå…¨æ”¯æŒ |
|              | æƒé™æ§åˆ¶     | è¯ä¹¦æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®                  | âœ… å®Œå…¨æ”¯æŒ |
|              | SSH å¯†é’¥è®¤è¯ | æ”¯æŒå…å¯†ç™»å½•                          | âœ… å®Œå…¨æ”¯æŒ |

### DNS æä¾›å•†æ”¯æŒ

| DNS æä¾›å•†     | ACME ç±»å‹         | ç¯å¢ƒå˜é‡                                       | æ³›åŸŸåæ”¯æŒ | æµ‹è¯•çŠ¶æ€    |
| -------------- | ----------------- | ---------------------------------------------- | ---------- | ----------- |
| **é˜¿é‡Œäº‘ DNS** | `dns_ali`         | `Ali_Key`, `Ali_Secret`                        | âœ…         | âœ… ç”Ÿäº§éªŒè¯ |
| **è…¾è®¯äº‘ DNS** | `dns_dp`          | `DP_Id`, `DP_Key`                              | âœ…         | âœ… ç”Ÿäº§éªŒè¯ |
| **åä¸ºäº‘ DNS** | `dns_huaweicloud` | `HUAWEICLOUD_Username`, `HUAWEICLOUD_Password` | âœ…         | âœ… æ”¯æŒ     |
| **å…¶ä»– DNS**   | å¯æ‰©å±•            | -                                              | -          | ğŸ”„ å¯å®šåˆ¶   |

### è‡ªåŠ¨åŒ–ä»»åŠ¡

| ä»»åŠ¡     | æ‰§è¡Œæ—¶é—´     | åŠŸèƒ½                                 |
| -------- | ------------ | ------------------------------------ |
| è¯ä¹¦ç›‘æ§ | æ¯æ—¥ 02:00   | ç›‘æ§æ‰€æœ‰è¯ä¹¦è¿‡æœŸçŠ¶æ€ï¼Œå‘é€å‘Šè­¦       |
| è‡ªåŠ¨ç»­æœŸ | æ¯æ—¥ 03:00   | è‡ªåŠ¨ç»­æœŸå³å°†è¿‡æœŸçš„è¯ä¹¦ï¼ˆ30 å¤©å†…ï¼‰    |
| çŠ¶æ€æŠ¥å‘Š | æ¯æ—¥ 11:00   | ç”Ÿæˆå¹¶å‘é€è¯ä¹¦çŠ¶æ€æŠ¥å‘Š               |
| æ¸…ç†å¤‡ä»½ | æ¯å‘¨æ—¥ 04:00 | æ¸…ç†è¿‡æœŸæ—¥å¿—å’Œå¤‡ä»½æ–‡ä»¶ï¼ˆä¿ç•™ 90 å¤©ï¼‰ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„ä¸ç»„ä»¶

### ç³»ç»Ÿæ¶æ„å›¾

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     SSL è¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†ç³»ç»Ÿæ¶æ„                                 â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                             â•‘
â•‘                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â•‘
â•‘                          â”‚   Prometheus ç›‘æ§    â”‚                           â•‘
â•‘                          â”‚   (Port 9090)       â”‚                           â•‘
â•‘                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â•‘
â•‘                                     â”‚                                       â•‘
â•‘                                     â–¼                                       â•‘
â•‘  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â•‘
â•‘  â•‘            ğŸ¯ è¯ä¹¦ç®¡ç†æ ¸å¿ƒå¼•æ“ (cert-manager.sh)                   â•‘    â•‘
â•‘  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£    â•‘
â•‘  â•‘                                                                   â•‘    â•‘
â•‘  â•‘  ğŸ“‹ è¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†                                               â•‘    â•‘
â•‘  â•‘    â€¢ generate        å•åŸŸåè¯ä¹¦ç”Ÿæˆ                               â•‘    â•‘
â•‘  â•‘    â€¢ generate-all    æ‰¹é‡è¯ä¹¦ç”Ÿæˆ                                 â•‘    â•‘
â•‘  â•‘    â€¢ deploy          å•åŸŸåè¯ä¹¦éƒ¨ç½²                               â•‘    â•‘
â•‘  â•‘    â€¢ deploy-all      æ‰¹é‡è¯ä¹¦éƒ¨ç½²                                 â•‘    â•‘
â•‘  â•‘    â€¢ renew           å•åŸŸåè¯ä¹¦ç»­æœŸ                               â•‘    â•‘
â•‘  â•‘    â€¢ renew-all       æ‰¹é‡è¯ä¹¦ç»­æœŸ                                 â•‘    â•‘
â•‘  â•‘                                                                   â•‘    â•‘
â•‘  â•‘  ğŸ“Š ç›‘æ§ä¸å‘Šè­¦                                                     â•‘    â•‘
â•‘  â•‘    â€¢ status          è¯ä¹¦çŠ¶æ€æŸ¥è¯¢                                 â•‘    â•‘
â•‘  â•‘    â€¢ monitor         è¿‡æœŸç›‘æ§å‘Šè­¦                                 â•‘    â•‘
â•‘  â•‘    â€¢ notify          å¤šæ¸ é“é€šçŸ¥                                   â•‘    â•‘
â•‘  â•‘                                                                   â•‘    â•‘
â•‘  â•‘  ğŸ”§ è¿ç»´å·¥å…·                                                       â•‘    â•‘
â•‘  â•‘    â€¢ backup          è¯ä¹¦å¤‡ä»½                                     â•‘    â•‘
â•‘  â•‘    â€¢ restore         è¯ä¹¦æ¢å¤                                     â•‘    â•‘
â•‘  â•‘    â€¢ cleanup         æ—¥å¿—æ¸…ç†                                     â•‘    â•‘
â•‘  â•‘                                                                   â•‘    â•‘
â•‘  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•‘
â•‘                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â•‘
â•‘                â”‚                            â”‚                             â•‘
â•‘         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                      â•‘
â•‘         â”‚ ğŸ” ACME å¼•æ“ â”‚              â”‚ ğŸ“¡ éƒ¨ç½²å¼•æ“  â”‚                      â•‘
â•‘         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â•‘
â•‘                â”‚                            â”‚                             â•‘
â•‘       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                    â•‘
â•‘       â”‚                 â”‚          â”‚                 â”‚                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â•‘
â•‘  â”‚ ACME.sh â”‚     â”‚  DNS APIs  â”‚   â”‚   â”‚ SSH/SCP  â”‚  â”‚                    â•‘
â•‘  â”‚ (Let's  â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚   â”‚ (Remote  â”‚  â”‚                    â•‘
â•‘  â”‚ Encrypt)â”‚     â”‚  â”‚ é˜¿é‡Œäº‘ â”‚ â”‚   â”‚   â”‚ Deploy)  â”‚  â”‚                    â•‘
â•‘  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚                    â•‘
â•‘       â”‚          â”‚  â”‚ è…¾è®¯äº‘ â”‚ â”‚   â”‚        â”‚        â”‚                    â•‘
â•‘       â”‚          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚        â”‚        â”‚                    â•‘
â•‘       â”‚          â”‚  â”‚ åä¸ºäº‘ â”‚ â”‚   â”‚        â”‚        â”‚                    â•‘
â•‘       â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚        â”‚        â”‚                    â•‘
â•‘       â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚        â”‚        â”‚                    â•‘
â•‘       â”‚                 â”‚         â”‚        â”‚        â”‚                    â•‘
â•‘       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â•‘
â•‘                              â”‚                                            â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â•‘
â•‘  â”‚                    ğŸŒ å¤–éƒ¨æœåŠ¡å’Œèµ„æº                           â”‚        â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â•‘
â•‘  â”‚  â€¢ Let's Encrypt CA        â€¢ DNS Provider API                â”‚        â•‘
â•‘  â”‚  â€¢ Remote Target Servers   â€¢ Notification Services           â”‚        â•‘
â•‘  â”‚  â€¢ Prometheus Exporter     â€¢ Cron Job Scheduler              â”‚        â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â•‘
â•‘                                                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                          ğŸ’¾ æ•°æ®å­˜å‚¨å±‚                                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ğŸ“ /config         YAML é…ç½®æ–‡ä»¶                                         â•‘
â•‘     â”œâ”€ domains.yml          åŸŸåé…ç½® (æ³›åŸŸå/å­åŸŸå/è‡ªå®šä¹‰)                â•‘
â•‘     â”œâ”€ dns-providers.yml    DNS æä¾›å•†å‡­è¯ (é˜¿é‡Œäº‘/è…¾è®¯äº‘/åä¸ºäº‘)          â•‘
â•‘     â”œâ”€ servers.yml          ç›®æ ‡æœåŠ¡å™¨é…ç½® (SSH/è·¯å¾„/æƒé™)                 â•‘
â•‘     â””â”€ notify.yml           é€šçŸ¥é…ç½® (é‚®ä»¶/ä¼ä¸šå¾®ä¿¡/é’‰é’‰)                  â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“ /data/certs     è¯ä¹¦å­˜å‚¨ç›®å½•                                          â•‘
â•‘     â”œâ”€ domain_ecc/          ECC è¯ä¹¦ (æ¨è,æ›´å®‰å…¨é«˜æ•ˆ)                    â•‘
â•‘     â””â”€ domain/              RSA è¯ä¹¦ (å…¼å®¹æ¨¡å¼)                           â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“ /data/logs      æ—¥å¿—æ–‡ä»¶                                              â•‘
â•‘     â”œâ”€ cert-manager.log     è¯ä¹¦ç®¡ç†æ“ä½œæ—¥å¿—                              â•‘
â•‘     â”œâ”€ error.log            é”™è¯¯æ—¥å¿—                                      â•‘
â•‘     â””â”€ cron.log             å®šæ—¶ä»»åŠ¡æ—¥å¿—                                  â•‘
â•‘                                                                           â•‘
â•‘  ğŸ“ /data/backups   å¤‡ä»½æ–‡ä»¶                                              â•‘
â•‘     â”œâ”€ local/               æœ¬åœ°å¤‡ä»½ (è‡ªåŠ¨/æ‰‹åŠ¨)                          â•‘
â•‘     â””â”€ remote/              è¿œç¨‹å¤‡ä»½ (ç›®æ ‡æœåŠ¡å™¨)                         â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### æ ¸å¿ƒç»„ä»¶è¯´æ˜

| ç»„ä»¶             | æŠ€æœ¯æ ˆ        | åŠŸèƒ½                                           |
| ---------------- | ------------- | ---------------------------------------------- |
| **è¯ä¹¦ç®¡ç†å¼•æ“** | Bash, acme.sh | æ ¸å¿ƒè¯ä¹¦ç”Ÿå‘½å‘¨æœŸç®¡ç†(ç”Ÿæˆ/éƒ¨ç½²/ç»­æœŸ/ç›‘æ§/å¤‡ä»½) |
| **ACME å¼•æ“**    | acme.sh       | Let's Encrypt è¯ä¹¦ç”³è¯·å’Œ DNS-01 éªŒè¯           |
| **éƒ¨ç½²å¼•æ“**     | SSH/SCP       | è¿œç¨‹æœåŠ¡å™¨è¯ä¹¦éƒ¨ç½²å’Œé…ç½®æ›´æ–°                   |
| **ç›‘æ§æœåŠ¡**     | Prometheus    | ç³»ç»Ÿæ€§èƒ½ç›‘æ§å’Œè¯ä¹¦çŠ¶æ€å‘Šè­¦                     |
| **å·¥å…·è„šæœ¬**     | Bash, Python  | æ—¥å¿—è®°å½•ã€é€šçŸ¥æ¨é€ã€å¤‡ä»½æ¢å¤ã€æ¸…ç†ç»´æŠ¤         |
| **å®šæ—¶ä»»åŠ¡**     | Cron          | è‡ªåŠ¨åŒ–ä»»åŠ¡è°ƒåº¦(æ¯æ—¥ç›‘æ§/ç»­æœŸ/æŠ¥å‘Š/å‘¨æ¸…ç†)      |

### ç›®å½•ç»“æ„

```
acme/
â”œâ”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml           # Dockerç¼–æ’é…ç½®
â”œâ”€â”€ Dockerfile                   # å®¹å™¨é•œåƒæ„å»ºæ–‡ä»¶
â”‚
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ domains.yml.example      # åŸŸåé…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ dns-providers.yml.example# DNSæä¾›å•†é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ servers.yml.example      # æœåŠ¡å™¨é…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ notify.yml.example       # é€šçŸ¥é…ç½®æ¨¡æ¿
â”‚
â”œâ”€â”€ scripts/                     # è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ cert-manager.sh          # ä¸»è¯ä¹¦ç®¡ç†è„šæœ¬(1360è¡Œ)
â”‚   â”œâ”€â”€ cert-manager-simple.sh   # ç®€åŒ–ç‰ˆçŠ¶æ€æŸ¥çœ‹è„šæœ¬
â”‚   â”œâ”€â”€ install.sh               # å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ utils/                   # å·¥å…·è„šæœ¬
â”‚       â”œâ”€â”€ logger.sh            # æ—¥å¿—å·¥å…·
â”‚       â”œâ”€â”€ notify.sh            # é€šçŸ¥å·¥å…·
â”‚       â””â”€â”€ backup.sh            # å¤‡ä»½å·¥å…·
â”‚
â”œâ”€â”€ web/                         # Webç•Œé¢
â”‚   â”œâ”€â”€ index.html               # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ api_server.py            # Flask APIæœåŠ¡å™¨(755è¡Œ)
â”‚   â”œâ”€â”€ manual-domains.html      # æ‰‹åŠ¨åŸŸåç®¡ç†é¡µé¢
â”‚   â””â”€â”€ start_server.sh          # å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ monitoring/                  # ç›‘æ§é…ç½®
â”‚   â””â”€â”€ prometheus.yml           # Prometheusé…ç½®
â”‚
â””â”€â”€ data/                        # æ•°æ®ç›®å½•(è¿è¡Œæ—¶ç”Ÿæˆ)
    â”œâ”€â”€ certs/                   # è¯ä¹¦å­˜å‚¨
    â”‚   â”œâ”€â”€ domain.com_ecc/      # ECCè¯ä¹¦
    â”‚   â””â”€â”€ domain.com/          # RSAè¯ä¹¦
    â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
    â”‚   â”œâ”€â”€ cert-manager.log     # ä¸»æ—¥å¿—
    â”‚   â”œâ”€â”€ cert-manager-error.log# é”™è¯¯æ—¥å¿—
    â”‚   â””â”€â”€ cron.log             # å®šæ—¶ä»»åŠ¡æ—¥å¿—
    â””â”€â”€ backups/                 # å¤‡ä»½æ–‡ä»¶
        â”œâ”€â”€ local/               # æœ¬åœ°å¤‡ä»½
        â””â”€â”€ remote_*/            # è¿œç¨‹å¤‡ä»½
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

| é¡¹ç›®               | è¦æ±‚                | è¯´æ˜                 |
| ------------------ | ------------------- | -------------------- |
| **Docker**         | >= 20.10            | å®¹å™¨è¿è¡Œç¯å¢ƒ         |
| **Docker Compose** | >= 2.0              | å®¹å™¨ç¼–æ’å·¥å…·         |
| **åŸŸå DNS**       | API è®¿é—®æƒé™        | é˜¿é‡Œäº‘/è…¾è®¯äº‘/åä¸ºäº‘ |
| **æœåŠ¡å™¨ SSH**     | å…å¯†ç™»å½•            | ç”¨äºè¯ä¹¦éƒ¨ç½²         |
| **æ“ä½œç³»ç»Ÿ**       | Linux/macOS/Windows | æ”¯æŒ Docker å³å¯     |
| **ç£ç›˜ç©ºé—´**       | >= 1GB              | è¯ä¹¦å’Œæ—¥å¿—å­˜å‚¨       |

### 2. å®‰è£…éƒ¨ç½²

#### æ­¥éª¤ 1ï¼šå…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/acme-ssl-manager.git
cd acme-ssl-manager/acme

# æ£€æŸ¥ç›®å½•ç»“æ„
ls -la
```

#### æ­¥éª¤ 2ï¼šé…ç½® SSH å…å¯†ç™»å½•

```bash
# ç”ŸæˆSSHå¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa

# å¤åˆ¶å…¬é’¥åˆ°ç›®æ ‡æœåŠ¡å™¨
ssh-copy-id root@your-server-ip

# æµ‹è¯•è¿æ¥
ssh root@your-server-ip "echo 'SSHè¿æ¥æˆåŠŸ'"
```

#### æ­¥éª¤ 3ï¼šå¯åŠ¨ç³»ç»Ÿ

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# éªŒè¯ç³»ç»Ÿå¥åº·
docker exec acme-ssl-manager /scripts/cert-manager-simple.sh health-check
```

### 3. åŸºæœ¬é…ç½®

#### é…ç½® DNS æä¾›å•†

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/dns-providers.yml.example config/dns-providers.yml

# ç¼–è¾‘é…ç½®ï¼ˆå¡«å…¥ä½ çš„ API å¯†é’¥ï¼‰
nano config/dns-providers.yml
```

**é˜¿é‡Œäº‘é…ç½®ç¤ºä¾‹ï¼š**

```yaml
dns_providers:
  aliyun:
    env_vars:
      Ali_Key: "ä½ çš„é˜¿é‡Œäº‘AccessKey"
      Ali_Secret: "ä½ çš„é˜¿é‡Œäº‘Secret"
```

#### é…ç½®åŸŸå

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/domains.yml.example config/domains.yml

# ç¼–è¾‘é…ç½®
nano config/domains.yml
```

**å•åŸŸåé…ç½®ç¤ºä¾‹ï¼š**

```yaml
domains:
  - domain: example.com
    subdomains:
      - api.example.com
    dns_provider: aliyun
    servers:
      - server_main
    auto_renew: true
```

#### é…ç½®æœåŠ¡å™¨

```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/servers.yml.example config/servers.yml

# ç¼–è¾‘é…ç½®
nano config/servers.yml
```

**æœåŠ¡å™¨é…ç½®ç¤ºä¾‹ï¼š**

```yaml
servers:
  server_main:
    host: "192.168.1.100"
    user: "root"
    ssl_dir: "/opt/docker/nginx/ssl"
    reload_cmd: "docker restart nginx"
```

### 4. è¯ä¹¦æ“ä½œ

#### ç”Ÿæˆè¯ä¹¦

```bash
# ç”Ÿæˆå•ä¸ªåŸŸåè¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh generate api.example.com

# ç”Ÿæˆæ³›åŸŸåè¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh generate "*.example.com"

# ç”Ÿæˆæ‰€æœ‰é…ç½®çš„è¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh generate-all
```

#### éƒ¨ç½²è¯ä¹¦

```bash
# éƒ¨ç½²åˆ°æŒ‡å®šæœåŠ¡å™¨
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy api.example.com server_main

# éƒ¨ç½²æ‰€æœ‰è¯ä¹¦ï¼ˆè‡ªåŠ¨è·³è¿‡ deploy_method: manual çš„åŸŸåï¼‰
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy-all

# æŸ¥çœ‹éœ€è¦æ‰‹åŠ¨å¤„ç†çš„åŸŸå
docker exec acme-ssl-manager /scripts/cert-manager.sh list-manual
```

#### ç»­æœŸè¯ä¹¦

```bash
# ç»­æœŸå•ä¸ªè¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh renew api.example.com

# ç»­æœŸæ‰€æœ‰å³å°†è¿‡æœŸçš„è¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh renew-all
```

#### æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦çŠ¶æ€
docker exec acme-ssl-manager /scripts/cert-manager.sh status-all

# æŸ¥çœ‹å•ä¸ªè¯ä¹¦çŠ¶æ€
docker exec acme-ssl-manager /scripts/cert-manager.sh status api.example.com

# ç”Ÿæˆå¹¶å‘é€è¯ä¹¦çŠ¶æ€æŠ¥å‘Š
docker exec acme-ssl-manager /scripts/cert-manager.sh report

# ç³»ç»Ÿå¥åº·æ£€æŸ¥
docker exec acme-ssl-manager /scripts/cert-manager-simple.sh health-check
```

**ğŸ” çŠ¶æ€æ£€æŸ¥è¯´æ˜**ï¼š

- ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹ ECC å’Œ RSA è¯ä¹¦æ ¼å¼
- æ™ºèƒ½è§£æè¯ä¹¦è¿‡æœŸæ—¶é—´ï¼Œå…¼å®¹ä¸åŒæ—¥æœŸæ ¼å¼
- é”™è¯¯å®¹é”™æœºåˆ¶ç¡®ä¿æ‰€æœ‰åŸŸåéƒ½è¢«æ£€æŸ¥
- æ”¯æŒæ³›åŸŸåè¯ä¹¦å’Œå•åŸŸåè¯ä¹¦æ··åˆç®¡ç†

## ğŸ“ é…ç½®æŒ‡å—

æœ¬èŠ‚è¯¦ç»†ä»‹ç»ç³»ç»Ÿçš„æ‰€æœ‰é…ç½®æ–‡ä»¶åŠå…¶å‚æ•°è¯´æ˜ã€‚

### 1. DNS æä¾›å•†é…ç½® (`config/dns-providers.yml`)

DNS æä¾›å•†é…ç½®æ–‡ä»¶ç”¨äºå­˜å‚¨å„ä¸ª DNS æœåŠ¡å•†çš„ API å‡­è¯ä¿¡æ¯ã€‚

#### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
dns_providers:
  provider_id: # DNSæä¾›å•†å”¯ä¸€æ ‡è¯†ç¬¦
    provider_name: "" # æä¾›å•†åç§°ï¼ˆæ˜¾ç¤ºç”¨ï¼‰
    acme_dns_type: "" # ACME.sh DNSç±»å‹
    api_endpoint: "" # APIç«¯ç‚¹åœ°å€
    credentials: # APIå‡­è¯
      access_key_id: "" # è®¿é—®å¯†é’¥ID
      access_key_secret: "" # è®¿é—®å¯†é’¥Secret
      region: "" # åŒºåŸŸè®¾ç½®ï¼ˆå¯é€‰ï¼‰
    env_vars: # ACME.shç¯å¢ƒå˜é‡æ˜ å°„
      VAR_NAME: "value" # ç¯å¢ƒå˜é‡é”®å€¼å¯¹
    options: # é…ç½®é€‰é¡¹
      ttl: 600 # DNSè®°å½•TTLï¼ˆç§’ï¼‰
      timeout: 30 # APIè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
      max_retries: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°
      retry_interval: 10 # é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
```

#### é˜¿é‡Œäº‘ DNS é…ç½®ç¤ºä¾‹

```yaml
dns_providers:
  aliyun:
    provider_id: aliyun
    provider_name: "é˜¿é‡Œäº‘DNS"
    acme_dns_type: dns_ali
    api_endpoint: "https://alidns.aliyuncs.com"
    credentials:
      access_key_id: ""
      access_key_secret: "your_aliyun"
      region: "cn-hangzhou"
    env_vars:
      Ali_Key: ""
      Ali_Secret: "your_aliyun"
    options:
      ttl: 600
      timeout: 30
      max_retries: 3
      retry_interval: 10
```

#### è…¾è®¯äº‘ DNS é…ç½®ç¤ºä¾‹

```yaml
dns_providers:
  tencent:
    provider_id: tencent
    provider_name: "è…¾è®¯äº‘DNS"
    acme_dns_type: dns_dp
    api_endpoint: "https://dnspod.tencentcloudapi.com"
    credentials:
      secret_id: "583967"
      secret_key: "ddfdec56413daf3f29921ef0db3bdd4c"
      region: "ap-beijing"
    env_vars:
      DP_Id: "583967"
      DP_Key: "ddfdec56413daf3f29921ef0db3bdd4c"
    options:
      ttl: 600
      timeout: 30
      max_retries: 3
      retry_interval: 10
```

#### å‚æ•°è¯´æ˜

| å‚æ•°                     | å¿…å¡« | è¯´æ˜                                          |
| ------------------------ | ---- | --------------------------------------------- |
| `provider_id`            | âœ…   | DNS æä¾›å•†å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŸŸåé…ç½®ä¸­å¼•ç”¨      |
| `provider_name`          | âœ…   | æä¾›å•†æ˜¾ç¤ºåç§°                                |
| `acme_dns_type`          | âœ…   | ACME.sh æ”¯æŒçš„ DNS ç±»å‹ï¼ˆå¦‚ dns_ali, dns_dpï¼‰ |
| `api_endpoint`           | âšª   | API ç«¯ç‚¹åœ°å€ï¼ˆæŸäº›æä¾›å•†éœ€è¦ï¼‰                |
| `credentials`            | âœ…   | API è®¤è¯å‡­è¯                                  |
| `env_vars`               | âœ…   | ACME.sh æ‰€éœ€çš„ç¯å¢ƒå˜é‡æ˜ å°„                    |
| `options.ttl`            | âšª   | DNS è®°å½•ç”Ÿå­˜æ—¶é—´ï¼Œé»˜è®¤ 600 ç§’                 |
| `options.timeout`        | âšª   | API è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 30 ç§’                  |
| `options.max_retries`    | âšª   | API è¯·æ±‚æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 3 æ¬¡               |
| `options.retry_interval` | âšª   | é‡è¯•é—´éš”æ—¶é—´ï¼Œé»˜è®¤ 10 ç§’                      |

#### å®‰å…¨æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶æƒé™**: è®¾ç½®ä¸º `600` æˆ– `400`ï¼Œç¡®ä¿åªæœ‰æ‰€æœ‰è€…å¯è¯»

   ```bash
   chmod 600 config/dns-providers.yml
   ```

2. **ç‰ˆæœ¬æ§åˆ¶**: ä¸è¦å°†åŒ…å«çœŸå®å¯†é’¥çš„æ–‡ä»¶æäº¤åˆ° Git

   ```bash
   # .gitignore ä¸­å·²åŒ…å«
   config/dns-providers.yml
   ```

3. **å¯†é’¥è½®æ¢**: å»ºè®®å®šæœŸæ›´æ¢ API å¯†é’¥

4. **ç¯å¢ƒå˜é‡**: ç”Ÿäº§ç¯å¢ƒå¯ä½¿ç”¨ç¯å¢ƒå˜é‡ä»£æ›¿ç¡¬ç¼–ç 

### 2. åŸŸåé…ç½® (`config/domains.yml`)

åŸŸåé…ç½®æ–‡ä»¶å®šä¹‰éœ€è¦ç®¡ç†çš„åŸŸååŠå…¶è¯ä¹¦é…ç½®ã€‚

#### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
domains:
  - domain: "" # ä¸»åŸŸå
    subdomains: # å­åŸŸååˆ—è¡¨
      - domain: "" # å­åŸŸåï¼ˆæ‰©å±•æ ¼å¼ï¼‰
        deploy_dir: "" # éƒ¨ç½²ç›®å½•ï¼ˆå¯é€‰ï¼‰
        cert_filename: "" # è¯ä¹¦æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰
        key_filename: "" # ç§é’¥æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰
        deploy_method: "" # éƒ¨ç½²æ–¹å¼: auto/manualï¼ˆå¯é€‰ï¼‰
    wildcard: true/false # æ˜¯å¦ç”³è¯·æ³›åŸŸåè¯ä¹¦
    dns_provider: "" # DNSæä¾›å•†ID
    servers: [] # ç›®æ ‡æœåŠ¡å™¨åˆ—è¡¨
    cert_type: "" # è¯ä¹¦ç±»å‹: wildcard/single
    auto_renew: true/false # æ˜¯å¦è‡ªåŠ¨ç»­æœŸ
    renew_before_days: 30 # æå‰ç»­æœŸå¤©æ•°
    description: "" # åŸŸåæè¿°
```

#### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
domains:
  # ç¤ºä¾‹1: åŸºç¡€æ³›åŸŸåé…ç½®
  - domain: example.com
    subdomains:
      - api.example.com
      - www.example.com
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_main
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "ç¤ºä¾‹åŸŸåSSLè¯ä¹¦"

  # ç¤ºä¾‹2: é«˜çº§è‡ªå®šä¹‰é…ç½®
  - domain: advanced.com
    subdomains:
      - domain: api.advanced.com
        deploy_dir: api.advanced.com
        cert_filename: fullchain.cer
        key_filename: advanced.com.key
        deploy_method: auto
      - domain: static.advanced.com
        deploy_method: manual # CDNæ‰‹åŠ¨ä¸Šä¼ 
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_main
      - server_backup
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "é«˜çº§é…ç½®ç¤ºä¾‹"

# å…¨å±€é»˜è®¤é…ç½®
global:
  default_deploy_method: auto
  default_cert_type: wildcard
  default_auto_renew: true
  default_renew_before_days: 30
```

#### å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°                         | ç±»å‹    | å¿…å¡« | é»˜è®¤å€¼     | è¯´æ˜                                    |
| ---------------------------- | ------- | ---- | ---------- | --------------------------------------- |
| `domain`                     | String  | âœ…   | -          | ä¸»åŸŸåï¼ˆå¦‚ example.comï¼‰                |
| `subdomains`                 | Array   | âœ…   | -          | å­åŸŸååˆ—è¡¨ï¼ˆå­—ç¬¦ä¸²æˆ–å¯¹è±¡ï¼‰              |
| `subdomains[].domain`        | String  | âœ…   | -          | å­åŸŸåå®Œæ•´åç§°                          |
| `subdomains[].deploy_dir`    | String  | âšª   | å­åŸŸå     | è¯ä¹¦éƒ¨ç½²ç›®å½•å                          |
| `subdomains[].cert_filename` | String  | âšª   | domain.cer | è¯ä¹¦æ–‡ä»¶å                              |
| `subdomains[].key_filename`  | String  | âšª   | domain.key | ç§é’¥æ–‡ä»¶å                              |
| `subdomains[].deploy_method` | String  | âšª   | auto       | éƒ¨ç½²æ–¹å¼ï¼ˆauto/manualï¼‰                 |
| `wildcard`                   | Boolean | âšª   | false      | æ˜¯å¦ç”³è¯·æ³›åŸŸåè¯ä¹¦                      |
| `dns_provider`               | String  | âœ…   | -          | DNS æä¾›å•† IDï¼ˆæ¥è‡ª dns-providers.ymlï¼‰ |
| `servers`                    | Array   | âœ…   | -          | ç›®æ ‡æœåŠ¡å™¨ ID åˆ—è¡¨                      |
| `cert_type`                  | String  | âšª   | single     | è¯ä¹¦ç±»å‹ï¼ˆwildcard/singleï¼‰             |
| `auto_renew`                 | Boolean | âšª   | true       | æ˜¯å¦è‡ªåŠ¨ç»­æœŸ                            |
| `renew_before_days`          | Integer | âšª   | 30         | æå‰ç»­æœŸå¤©æ•°                            |
| `description`                | String  | âšª   | -          | åŸŸåç”¨é€”æè¿°                            |

#### é…ç½®æœ€ä½³å®è·µ

1. **æ³›åŸŸåä¼˜å…ˆ**: å¯¹äºæœ‰å¤šä¸ªå­åŸŸåçš„æƒ…å†µï¼Œæ¨èä½¿ç”¨æ³›åŸŸåè¯ä¹¦
2. **åˆç†åˆ†ç»„**: å°†ç›¸å…³åŸŸåå½’ä¸ºåŒä¸€ç»„é…ç½®
3. **ç¯å¢ƒåŒºåˆ†**: ä½¿ç”¨ `description` æ ‡æ³¨ç¯å¢ƒï¼ˆç”Ÿäº§/æµ‹è¯•/å¼€å‘ï¼‰
4. **æ‰‹åŠ¨éƒ¨ç½²æ ‡è®°**: CDN åŸŸåè®¾ç½® `deploy_method: manual`

### 3. æœåŠ¡å™¨é…ç½® (`config/servers.yml`)

æœåŠ¡å™¨é…ç½®æ–‡ä»¶å®šä¹‰è¯ä¹¦éƒ¨ç½²çš„ç›®æ ‡æœåŠ¡å™¨ä¿¡æ¯ã€‚

#### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
servers:
  - server_id: "" # æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ç¬¦
    host: "" # æœåŠ¡å™¨IPæˆ–åŸŸå
    port: 22 # SSHç«¯å£
    user: "" # SSHç”¨æˆ·å
    ssh_key_path: "" # SSHç§é’¥è·¯å¾„
    ssl_cert_dir: "" # SSLè¯ä¹¦å­˜å‚¨ç›®å½•
    nginx_container: "" # Nginxå®¹å™¨åç§°
    nginx_reload_cmd: "" # Nginxé‡å¯å‘½ä»¤
    backup_dir: "" # è¯ä¹¦å¤‡ä»½ç›®å½•
    connection_timeout: 10 # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    max_retry: 3 # æœ€å¤§é‡è¯•æ¬¡æ•°
    description: "" # æœåŠ¡å™¨æè¿°
    environment: "" # ç¯å¢ƒæ ‡è¯†: production/staging/development
```

#### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
servers:
  # ç”Ÿäº§æœåŠ¡å™¨ç¤ºä¾‹
  - server_id: server_prod_001
    host: 192.168.1.100
    port: 22
    user: root
    ssh_key_path: ~/.ssh/id_rsa
    ssl_cert_dir: /opt/docker/nginx/ssl
    nginx_container: nginx
    nginx_reload_cmd: docker restart nginx
    backup_dir: /opt/docker/nginx/ssl/backups
    connection_timeout: 10
    max_retry: 3
    description: "ä¸»è¦ç”Ÿäº§æœåŠ¡å™¨"
    environment: production

  # ä½¿ç”¨ç³»ç»Ÿnginxçš„æœåŠ¡å™¨
  - server_id: server_prod_002
    host: 192.168.1.200
    port: 22
    user: root
    ssh_key_path: ~/.ssh/id_rsa
    ssl_cert_dir: /etc/nginx/ssl
    nginx_container: nginx # ç³»ç»Ÿnginx
    nginx_reload_cmd: nginx -t && nginx -s reload
    backup_dir: /etc/nginx/ssl/backups
    connection_timeout: 10
    max_retry: 3
    description: "ç³»ç»ŸNginxæœåŠ¡å™¨"
    environment: production

# å…¨å±€æœåŠ¡å™¨é…ç½®
global:
  ssh:
    ssh_options:
      - "-o ConnectTimeout=10"
      - "-o BatchMode=yes"
      - "-o StrictHostKeyChecking=accept-new"
    scp_options:
      - "-q"
      - "-o ConnectTimeout=10"

  cert_permissions:
    key_file: "600" # ç§é’¥æ–‡ä»¶æƒé™
    cert_file: "644" # è¯ä¹¦æ–‡ä»¶æƒé™
    directory: "755" # ç›®å½•æƒé™

  pre_deploy_checks:
    - check_ssh_connection
    - check_target_directory
    - check_nginx_config_syntax
    - backup_existing_certs

  post_deploy_checks:
    - verify_cert_files
    - check_nginx_status
    - test_ssl_connection
    - update_cert_database
```

#### å‚æ•°è¯¦ç»†è¯´æ˜

| å‚æ•°                 | ç±»å‹    | å¿…å¡« | è¯´æ˜                          |
| -------------------- | ------- | ---- | ----------------------------- |
| `server_id`          | String  | âœ…   | æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ç¬¦              |
| `host`               | String  | âœ…   | æœåŠ¡å™¨ IP åœ°å€æˆ–åŸŸå          |
| `port`               | Integer | âšª   | SSH ç«¯å£ï¼Œé»˜è®¤ 22             |
| `user`               | String  | âœ…   | SSH ç™»å½•ç”¨æˆ·å                |
| `ssh_key_path`       | String  | âšª   | SSH ç§é’¥æ–‡ä»¶è·¯å¾„              |
| `ssl_cert_dir`       | String  | âœ…   | è¯ä¹¦éƒ¨ç½²ç›®å½•ï¼ˆç»å¯¹è·¯å¾„ï¼‰      |
| `nginx_container`    | String  | âšª   | Nginx å®¹å™¨åç§°ï¼ˆDocker ç¯å¢ƒï¼‰ |
| `nginx_reload_cmd`   | String  | âœ…   | é‡æ–°åŠ è½½ Nginx çš„å‘½ä»¤         |
| `backup_dir`         | String  | âšª   | å¤‡ä»½æ–‡ä»¶å­˜å‚¨ç›®å½•              |
| `connection_timeout` | Integer | âšª   | SSH è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰        |
| `max_retry`          | Integer | âšª   | éƒ¨ç½²å¤±è´¥æœ€å¤§é‡è¯•æ¬¡æ•°          |
| `description`        | String  | âšª   | æœåŠ¡å™¨ç”¨é€”æè¿°                |
| `environment`        | String  | âšª   | ç¯å¢ƒæ ‡è¯†                      |

#### SSH é…ç½®æ³¨æ„äº‹é¡¹

1. **å…å¯†ç™»å½•é…ç½®**:

   ```bash
   # ç”ŸæˆSSHå¯†é’¥å¯¹
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa

   # å°†å…¬é’¥å¤åˆ¶åˆ°ç›®æ ‡æœåŠ¡å™¨
   ssh-copy-id -i ~/.ssh/id_rsa.pub user@server-ip

   # æµ‹è¯•SSHè¿æ¥
   ssh -i ~/.ssh/id_rsa user@server-ip "echo 'SSHè¿æ¥æˆåŠŸ'"
   ```

2. **SSH å¯†é’¥æƒé™**:

   ```bash
   chmod 600 ~/.ssh/id_rsa
   chmod 644 ~/.ssh/id_rsa.pub
   ```

3. **Docker å®¹å™¨è·¯å¾„**: ç¡®ä¿ `ssl_cert_dir` æ˜¯å®¹å™¨æŒ‚è½½è·¯å¾„ï¼Œè€Œéå®¹å™¨å†…è·¯å¾„

4. **Nginx é‡å¯å‘½ä»¤**: æ ¹æ®å®é™…ç¯å¢ƒé€‰æ‹©åˆé€‚çš„é‡å¯å‘½ä»¤
   - Docker: `docker restart container_name`
   - ç³»ç»ŸæœåŠ¡: `systemctl reload nginx`
   - ç›´æ¥å‘½ä»¤: `nginx -s reload`

### 4. é€šçŸ¥é…ç½® (`config/notify.yml`)

é€šçŸ¥é…ç½®æ–‡ä»¶å®šä¹‰è¯ä¹¦äº‹ä»¶çš„é€šçŸ¥æ–¹å¼å’Œæ¸ é“ã€‚

#### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
notifications:
  # é’‰é’‰é€šçŸ¥
  dingtalk:
    enabled: true/false
    webhook_url: ""
    access_token: ""
    secret: ""

  # é‚®ä»¶é€šçŸ¥
  email:
    enabled: true/false
    smtp:
      host: ""
      port: 587
      user: ""
      password: ""
      use_tls: true
    from: ""
    to: []

  # Webhooké€šçŸ¥
  webhook:
    enabled: true/false
    url: ""
    method: "POST"
    headers: {}
    body: {}

  # Slacké€šçŸ¥
  slack:
    enabled: true/false
    webhook_url: ""
    channel: ""
    username: ""

# é€šçŸ¥è§¦å‘é…ç½®
triggers:
  cert_expiry_warning:
    enabled: true
    days_before: [30, 15, 7, 1]
  cert_renewal_success:
    enabled: true
  cert_renewal_failure:
    enabled: true
  deployment_success:
    enabled: true
  deployment_failure:
    enabled: true
  system_error:
    enabled: true
```

#### å®Œæ•´é…ç½®ç¤ºä¾‹

```yaml
notifications:
  dingtalk:
    enabled: true
    webhook_url: "https://oapi.dingtalk.com/robot/send"
    access_token: "your-access-token"
    secret: "your-secret"

  email:
    enabled: true
    smtp:
      host: smtp.gmail.com
      port: 587
      user: ssl-manager@example.com
      password: "your-app-password"
      use_tls: true
    from: "SSL Manager <ssl-manager@example.com>"
    to:
      - admin@example.com
      - ops@example.com

  webhook:
    enabled: false
    url: "https://your-api.com/webhook"
    method: "POST"
    headers:
      Authorization: "Bearer your-token"
      Content-Type: "application/json"
    body:
      event: "{{event_type}}"
      domain: "{{domain}}"
      status: "{{status}}"
      timestamp: "{{timestamp}}"

triggers:
  cert_expiry_warning:
    enabled: true
    days_before: [30, 15, 7, 1]
  cert_renewal_success:
    enabled: true
  cert_renewal_failure:
    enabled: true
  deployment_success:
    enabled: false # å¯é€‰å…³é—­æˆåŠŸé€šçŸ¥
  deployment_failure:
    enabled: true
  system_error:
    enabled: true
```

#### æµ‹è¯•é€šçŸ¥é…ç½®

```bash
# æµ‹è¯•æ‰€æœ‰é€šçŸ¥æ¸ é“
docker exec acme-ssl-manager /scripts/utils/notify.sh test

# æµ‹è¯•ç‰¹å®šé€šçŸ¥æ¸ é“
docker exec acme-ssl-manager /scripts/utils/notify.sh test dingtalk
docker exec acme-ssl-manager /scripts/utils/notify.sh test email
```

---

## ğŸ“Š Web ç®¡ç†ç•Œé¢

- **è¯ä¹¦ç®¡ç†ç•Œé¢**: http://localhost:8080
- **ç›‘æ§é¢æ¿**: http://localhost:9090

### ğŸ¨ ç•Œé¢é¢„è§ˆ

CertHub æä¾›äº†ç°ä»£åŒ–ã€ç¾è§‚çš„ Web ç®¡ç†ç•Œé¢ï¼Œé‡‡ç”¨æ¸å˜è‰²è®¾è®¡å’Œç»ç’ƒæ€æ•ˆæœï¼š

![Web ç®¡ç†ç•Œé¢](images/monitor.jpeg)

**ç•Œé¢ç‰¹è‰²**ï¼š

- ğŸ¨ **ç°ä»£è®¾è®¡**: é‡‡ç”¨æ·±è‰²ä¸»é¢˜é…åˆç´«ç»¿æ¸å˜è‰²ï¼Œç§‘æŠ€æ„Ÿåè¶³
- âœ¨ **ç»ç’ƒæ€æ•ˆæœ**: æ¯›ç»ç’ƒèƒŒæ™¯å’ŒåŠ¨æ€å…‰æ™•ï¼Œè§†è§‰ä½“éªŒå‡ºè‰²
- ğŸ“± **å“åº”å¼å¸ƒå±€**: å®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- ğŸ¯ **ç›´è§‚ä»ªè¡¨ç›˜**: è¯ä¹¦ç»Ÿè®¡ã€å¥åº·çŠ¶æ€ã€è¿‡æœŸæé†’ä¸€ç›®äº†ç„¶
- ğŸ”” **å®æ—¶ç›‘æ§**: è¯ä¹¦çŠ¶æ€å®æ—¶æ›´æ–°ï¼Œåˆ°æœŸæé†’åŠæ—¶é€šçŸ¥
- ğŸ’ **ç²¾ç¾åŠ¨ç”»**: äº¤äº’æµç•…ï¼Œæ‚¬åœæ•ˆæœä¸°å¯Œ

### ğŸ› ï¸ Web ç®¡ç†ç•Œé¢åŠŸèƒ½

#### 1. ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰

- å®æ—¶æ˜¾ç¤ºè¯ä¹¦ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ€»æ•°ã€å¥åº·ã€å³å°†è¿‡æœŸï¼‰
- ç³»ç»ŸçŠ¶æ€ç›‘æ§ï¼ˆACME å®¢æˆ·ç«¯ã€è¿è¡ŒçŠ¶æ€ï¼‰
- è¯ä¹¦è¿‡æœŸæé†’ï¼ˆ30 å¤©å†…è¿‡æœŸé¢„è­¦ï¼‰
- ç²¾ç¾çš„æ•°æ®å¯è§†åŒ–å¡ç‰‡

#### 2. è¯ä¹¦ç®¡ç†

- ğŸ“‹ **è¯ä¹¦åˆ—è¡¨**: è¡¨æ ¼å½¢å¼å±•ç¤ºæ‰€æœ‰è¯ä¹¦è¯¦æƒ…
  - åŸŸåã€ç±»å‹ï¼ˆå•åŸŸå/æ³›åŸŸåï¼‰
  - çŠ¶æ€å¾½ç« ï¼ˆå¥åº·/è­¦å‘Š/è¿‡æœŸï¼‰
  - è¿‡æœŸæ—¶é—´å’Œå‰©ä½™å¤©æ•°
  - åŠ å¯†ç®—æ³•ï¼ˆECC/RSAï¼‰
  - è‡ªå®šä¹‰é…ç½®æ ‡è¯†
- ğŸ”„ **æ“ä½œåŠŸèƒ½**:
  - ä¸€é”®ç»­æœŸè¯ä¹¦
  - ä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼ˆZIP æ ¼å¼ï¼‰
  - åˆ é™¤è¿‡æœŸè¯ä¹¦
- âš™ï¸ **è‡ªå®šä¹‰é…ç½®**: æŸ¥çœ‹æ¯ä¸ªåŸŸåçš„éƒ¨ç½²é…ç½®
  - éƒ¨ç½²ç›®å½•
  - è¯ä¹¦æ–‡ä»¶å
  - ç§é’¥æ–‡ä»¶å
- â• **æ·»åŠ è¯ä¹¦**: å›¾å½¢åŒ–ç•Œé¢æ·»åŠ æ–°åŸŸåè¯ä¹¦

#### 3. ç³»ç»Ÿé…ç½®

- ğŸŒ **åŸŸåé…ç½®**: YAML æ ¼å¼é…ç½®åŸŸåå’Œå­åŸŸå
- ğŸ”Œ **DNS æä¾›å•†**: é…ç½®é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ API å¯†é’¥
- ğŸ–¥ï¸ **æœåŠ¡å™¨ç®¡ç†**: é…ç½®è¯ä¹¦éƒ¨ç½²çš„ç›®æ ‡æœåŠ¡å™¨
- ğŸ”” **é€šçŸ¥è®¾ç½®**: é‚®ä»¶ã€é’‰é’‰ç­‰é€šçŸ¥æ¸ é“é…ç½®

#### 4. æ—¥å¿—æŸ¥çœ‹

- ğŸ“ **è¯ä¹¦ç®¡ç†æ—¥å¿—**: ç”³è¯·ã€éƒ¨ç½²ã€ç»­æœŸå…¨æµç¨‹æ—¥å¿—
- âš ï¸ **é”™è¯¯æ—¥å¿—**: ç³»ç»Ÿå¼‚å¸¸å’Œé”™è¯¯ä¿¡æ¯
- â° **å®šæ—¶ä»»åŠ¡æ—¥å¿—**: Cron ä»»åŠ¡æ‰§è¡Œè®°å½•
- ğŸ”„ **å®æ—¶åˆ·æ–°**: æ”¯æŒæ‰‹åŠ¨åˆ·æ–°å’Œæ¸…ç©ºæ—¥å¿—

#### 5. ç›‘æ§é¢æ¿

- ğŸ“ˆ **ç³»ç»Ÿè¿è¡Œæ—¶é—´**: å®¹å™¨æŒç»­è¿è¡Œæ—¶é•¿
- ğŸ” **è¯ä¹¦æ£€æŸ¥è®°å½•**: æœ€è¿‘æ£€æŸ¥æ—¶é—´å’Œä¸‹æ¬¡æ£€æŸ¥è®¡åˆ’
- ğŸ“Š **è¯ä¹¦æ›´æ–°ç»Ÿè®¡**: æœ¬æœˆæ›´æ–°æ¬¡æ•°å’Œå†å²è®°å½•
- ğŸ’» **èµ„æºä½¿ç”¨æƒ…å†µ**: CPUã€å†…å­˜ã€ç£ç›˜å®æ—¶å ç”¨
- ğŸ¯ **è¯ä¹¦çŠ¶æ€åˆ†å¸ƒ**: å¥åº·ã€è­¦å‘Šã€è¿‡æœŸè¯ä¹¦åˆ†å¸ƒå›¾
- âœ… **æœåŠ¡å¥åº·æ£€æŸ¥**: ACME å®¢æˆ·ç«¯å’Œç³»ç»Ÿç»„ä»¶çŠ¶æ€

### ğŸ“± è®¿é—®æ–¹å¼

**è¯ä¹¦ç®¡ç†ç•Œé¢**ï¼š

```bash
http://localhost:8080
```

**Prometheus ç›‘æ§é¢æ¿**ï¼š

```bash
http://localhost:9090
```

### ğŸ¯ ä½¿ç”¨å»ºè®®

1. **å®šæœŸæ£€æŸ¥**: å»ºè®®æ¯å‘¨ç™»å½•ç®¡ç†ç•Œé¢æŸ¥çœ‹è¯ä¹¦çŠ¶æ€
2. **æå‰ç»­æœŸ**: åœ¨è¯ä¹¦åˆ°æœŸå‰ 30 å¤©ç³»ç»Ÿä¼šè‡ªåŠ¨ç»­æœŸ
3. **å¤‡ä»½è¯ä¹¦**: é‡è¦è¯ä¹¦å»ºè®®æ‰‹åŠ¨ä¸‹è½½å¤‡ä»½
4. **ç›‘æ§å‘Šè­¦**: é…ç½®é‚®ä»¶æˆ–é’‰é’‰é€šçŸ¥ï¼ŒåŠæ—¶æ¥æ”¶åˆ°æœŸæé†’

### ğŸ”§ è‡ªå®šä¹‰åŸŸåè¯ä¹¦é…ç½®

ç³»ç»Ÿæ”¯æŒä¸ºæ¯ä¸ªå­åŸŸåé…ç½®è‡ªå®šä¹‰çš„è¯ä¹¦åç§°å’Œéƒ¨ç½²ç›®å½•ï¼Œå¹¶æä¾›çµæ´»çš„éƒ¨ç½²æ–¹å¼é€‰æ‹©ã€‚

#### é…ç½®æ ¼å¼

åœ¨ `config/domains.yml` ä¸­ï¼Œå­åŸŸåæ”¯æŒä¸¤ç§é…ç½®æ ¼å¼ï¼š

**1. ç®€å•æ ¼å¼ï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰ï¼š**

```yaml
domains:
  - domain: example.com
    subdomains:
      - api.example.com
      - www.example.com
```

**2. æ‰©å±•æ ¼å¼ï¼ˆè‡ªå®šä¹‰é…ç½®ï¼‰ï¼š**

```yaml
domains:
  - domain: example.com
    subdomains:
      - domain: api.example.com
        deploy_dir: api.example.com # è‡ªå®šä¹‰éƒ¨ç½²ç›®å½•
        cert_filename: fullchain.cer # è‡ªå®šä¹‰è¯ä¹¦æ–‡ä»¶å
        key_filename: example.com.key # è‡ªå®šä¹‰ç§é’¥æ–‡ä»¶å
        deploy_method: auto # éƒ¨ç½²æ–¹å¼ï¼šautoï¼ˆè‡ªåŠ¨ï¼‰/manualï¼ˆæ‰‹åŠ¨ï¼‰
      - domain: www.example.com
        deploy_dir: www.example.com
        cert_filename: fullchain.cer
        key_filename: example.com.key
        deploy_method: auto
      - domain: static.example.com
        deploy_method: manual # æ‰‹åŠ¨ä¸Šä¼ åˆ°CDNï¼ˆå¦‚ä¸ƒç‰›äº‘ï¼‰
      - domain: assets.example.com
        deploy_method: manual # æ‰‹åŠ¨ä¸Šä¼ åˆ°CDNï¼ˆå¦‚é˜¿é‡Œäº‘CDNï¼‰
```

#### é…ç½®å‚æ•°è¯´æ˜

- **deploy_method**: è¯ä¹¦éƒ¨ç½²æ–¹å¼ ğŸ”§

  - é»˜è®¤å€¼ï¼š`auto`ï¼ˆè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼‰
  - å¯é€‰å€¼ï¼š
    - `auto`: è‡ªåŠ¨éƒ¨ç½²åˆ°é…ç½®çš„æœåŠ¡å™¨
    - `manual`: æ‰‹åŠ¨ä¸Šä¼ åˆ° CDNï¼ˆå¦‚ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘ CDN ç­‰ï¼‰
  - è¯´æ˜ï¼šè®¾ç½®ä¸º `manual` çš„åŸŸååœ¨æ‰¹é‡å¤„ç†æ—¶ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤è·³è¿‡
  - ç¤ºä¾‹ï¼š`static.example.com`ã€`assets.example.com` é€šå¸¸è®¾ç½®ä¸º `manual`
  - å…¨å±€é»˜è®¤ï¼šå¯åœ¨ `global.default_deploy_method` ä¸­è®¾ç½®

- **deploy_dir**: è¯ä¹¦éƒ¨ç½²åˆ°æœåŠ¡å™¨çš„ç›®å½•åç§°

  - é»˜è®¤å€¼ï¼šä½¿ç”¨å­åŸŸåä½œä¸ºç›®å½•å
  - ç¤ºä¾‹ï¼š`api.example.com` è¯ä¹¦é»˜è®¤éƒ¨ç½²åˆ° `/ssl_cert_dir/api.example.com/`
  - è‡ªå®šä¹‰ï¼šå¯ä»¥æŒ‡å®šä»»æ„ç›®å½•åï¼Œå¦‚ `custom-dir`

- **cert_filename**: è¯ä¹¦æ–‡ä»¶å

  - é»˜è®¤å€¼ï¼š`domain.cer`
  - æ¨èå€¼ï¼š`fullchain.cer` æˆ– `domain.pem`
  - ç¤ºä¾‹ï¼š`example.com.cer`, `fullchain.cer`

- **key_filename**: ç§é’¥æ–‡ä»¶å
  - é»˜è®¤å€¼ï¼š`domain.key`
  - æ¨èå€¼ï¼šä¿æŒç»Ÿä¸€å‘½å
  - ç¤ºä¾‹ï¼š`example.com.key`, `private.key`

#### å®é™…ä½¿ç”¨ç¤ºä¾‹

**åŸŸåé…ç½®ï¼š**

```yaml
domains:
  - domain: example-app.com
    subdomains:
      - domain: www.example-app.com
        deploy_dir: www.example-app.com
        cert_filename: fullchain.cer
        key_filename: example-app.com.key
        deploy_method: auto
      - domain: lightapi.example-app.com
        deploy_dir: lightapi.example-app.com
        cert_filename: fullchain.cer
        key_filename: example-app.com.key
        deploy_method: auto
      - domain: mch.example-app.com
        deploy_dir: mch.example-app.com
        cert_filename: fullchain.cer
        key_filename: example-app.com.key
        deploy_method: auto
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_prod_01
      - server_prod_02
```

**éƒ¨ç½²æ•ˆæœï¼š**

- è¯ä¹¦éƒ¨ç½²åˆ°ï¼š`/opt/docker/nginx/ssl/www.example-app.com/fullchain.cer`
- ç§é’¥éƒ¨ç½²åˆ°ï¼š`/opt/docker/nginx/ssl/www.example-app.com/example-app.com.key`
- è¯ä¹¦éƒ¨ç½²åˆ°ï¼š`/opt/docker/nginx/ssl/lightapi.example-app.com/fullchain.cer`
- ç§é’¥éƒ¨ç½²åˆ°ï¼š`/opt/docker/nginx/ssl/lightapi.example-app.com/example-app.com.key`

#### ç‰¹æ®Šåº”ç”¨åœºæ™¯

**1. å¤šä¸ªå­åŸŸåå…±äº«è¯ä¹¦æ–‡ä»¶**

```yaml
domains:
  - domain: domain.com
    subdomains:
      - domain: mall.domain.com
        deploy_dir: mall.domain.com
        cert_filename: fullchain.cer
        key_filename: domain.com.key
        deploy_method: auto
      - domain: wlhy.domain.com
        deploy_dir: domain.com # ä¸å…¶ä»–å­åŸŸåå…±äº«ç›®å½•
        cert_filename: fullchain.cer
        key_filename: domain.com.key
        deploy_method: auto
```

**2. ä¸åŒè¯ä¹¦æ ¼å¼æ··åˆä½¿ç”¨**

```yaml
domains:
  - domain: ly.domain.com
    subdomains:
      - domain: mall-beta.ly.domain.com
        deploy_dir: ly.domain.com
        cert_filename: ly.domain.com.pem # ä½¿ç”¨ .pem æ ¼å¼
        key_filename: ly.domain.com.key
        deploy_method: auto
      - domain: mall.ly.domain.com
        deploy_dir: mall.ly.domain.com
        cert_filename: fullchain.cer # ä½¿ç”¨ .cer æ ¼å¼
        key_filename: ly.domain.com.key
        deploy_method: auto
```

**3. æ··åˆéƒ¨ç½²æ–¹å¼ï¼ˆè‡ªåŠ¨+æ‰‹åŠ¨ï¼‰**

```yaml
domains:
  - domain: bshop.example-media.cn
    subdomains:
      - domain: static.bshop.example-media.cn # é™æ€èµ„æºåŸŸå
        deploy_method: manual # æ‰‹åŠ¨ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘CDN
      - domain: m.bshop.example-media.cn # æ‰‹æœºç«¯
        deploy_dir: example-media.cn
        cert_filename: fullchain.cer
        key_filename: example-media.cn.key
        deploy_method: auto # è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
      - domain: bshop.example-media.cn # å®˜ç½‘
        deploy_dir: bshop.example-media.cn
        cert_filename: fullchain.cer
        key_filename: example-media.cn.key
        deploy_method: auto # è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
    wildcard: true
    dns_provider: aliyun_hiyamedia
    servers:
      - server_190_164
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "BShopå¹³å°SSLè¯ä¹¦"
```

#### Web ç•Œé¢æ˜¾ç¤º

åœ¨ Web ç®¡ç†ç•Œé¢ä¸­ï¼Œè¯ä¹¦ç®¡ç†é¡µé¢ä¼šæ˜¾ç¤ºæ¯ä¸ªåŸŸåçš„è‡ªå®šä¹‰é…ç½®ï¼š

1. **è¯ä¹¦åˆ—è¡¨**: å¢åŠ "è‡ªå®šä¹‰é…ç½®"åˆ—ï¼Œæ˜¾ç¤ºéƒ¨ç½²æ–¹å¼æ ‡è¯†
2. **é…ç½®è¯¦æƒ…**: ç‚¹å‡»"æŸ¥çœ‹é…ç½®"æŒ‰é’®å¯ä»¥æŸ¥çœ‹ï¼š
   - éƒ¨ç½²æ–¹å¼ï¼ˆè‡ªåŠ¨/æ‰‹åŠ¨ï¼‰
   - éƒ¨ç½²ç›®å½•
   - è¯ä¹¦æ–‡ä»¶å
   - ç§é’¥æ–‡ä»¶å
3. **é…ç½®çŠ¶æ€**: åŒºåˆ†ä½¿ç”¨é»˜è®¤é…ç½®å’Œè‡ªå®šä¹‰é…ç½®çš„è¯ä¹¦
4. **æ‰¹é‡æ“ä½œ**: æ‰¹é‡éƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨è¿‡æ»¤ `deploy_method: manual` çš„åŸŸå
5. **æ‰‹åŠ¨åŸŸåç®¡ç†**: ä¸“é—¨çš„æ‰‹åŠ¨åŸŸåç®¡ç†é¡µé¢ (`/manual-domains.html`)ï¼š
   - æŸ¥çœ‹æ‰€æœ‰æ‰‹åŠ¨éƒ¨ç½²åŸŸå
   - ä¸‹è½½è¯ä¹¦æ–‡ä»¶
   - æŸ¥çœ‹ CDN é…ç½®æŒ‡å—ï¼ˆä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘ CDN ç­‰ï¼‰
   - è¯ä¹¦çŠ¶æ€ç›‘æ§

#### éƒ¨ç½²å‘½ä»¤ç¤ºä¾‹

**è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰ï¼š**

```bash
# ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®é…ç½®éƒ¨ç½²åˆ°æŒ‡å®šç›®å½•å’Œæ–‡ä»¶å
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy example-app.com server_prod_01
```

**æ‰‹åŠ¨éƒ¨ç½²ï¼š**

```bash
# æ‰‹åŠ¨éƒ¨ç½²åˆ°è‡ªå®šä¹‰ç›®å½•
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy example-app.com server_prod_01 www.example-app.com
```

#### æ³¨æ„äº‹é¡¹

1. **é…ç½®ä¸€è‡´æ€§**: ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•å’Œæ–‡ä»¶åä¸ nginx é…ç½®ä¸€è‡´
2. **æƒé™è®¾ç½®**: è¯ä¹¦æ–‡ä»¶æƒé™è®¾ç½®ä¸º 644ï¼Œç§é’¥æ–‡ä»¶æƒé™è®¾ç½®ä¸º 600
3. **è·¯å¾„éªŒè¯**: éƒ¨ç½²å‰éªŒè¯ç›®æ ‡æœåŠ¡å™¨çš„è·¯å¾„æ˜¯å¦å­˜åœ¨
4. **å¤‡ä»½ç­–ç•¥**: è‡ªå®šä¹‰é…ç½®ä¼šå½±å“å¤‡ä»½æ–‡ä»¶çš„å‘½åå’Œä½ç½®
5. **éƒ¨ç½²æ–¹å¼**:
   - `deploy_method: auto` çš„åŸŸåä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°é…ç½®çš„æœåŠ¡å™¨
   - `deploy_method: manual` çš„åŸŸåéœ€è¦æ‰‹åŠ¨ä¸Šä¼ åˆ° CDNï¼Œæ‰¹é‡å¤„ç†æ—¶ä¼šè¢«è·³è¿‡
   - ç¡®ä¿é™æ€èµ„æºåŸŸåï¼ˆå¦‚ static._ æˆ– assets._ï¼‰è®¾ç½®ä¸º `manual`

#### æ•…éšœæ’é™¤

**é…ç½®ä¸ç”Ÿæ•ˆï¼š**

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
docker exec acme-ssl-manager python3 -c "import yaml; yaml.safe_load(open('/config/domains.yml'))"

# é‡æ–°åŠ è½½é…ç½®
docker exec acme-ssl-manager /scripts/cert-manager.sh reload-config
```

**è¯ä¹¦æ–‡ä»¶æ‰¾ä¸åˆ°ï¼š**

```bash
# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶æ˜¯å¦åœ¨æŒ‡å®šä½ç½®
docker exec acme-ssl-manager ls -la /data/certs/domain_ecc/

# æ£€æŸ¥éƒ¨ç½²ç›®å½•
ssh user@server "ls -la /opt/docker/nginx/ssl/"
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### æœ€ä½³å®è·µå»ºè®®

#### è¯ä¹¦ç±»å‹é€‰æ‹©

- **æ¨èä½¿ç”¨ ECC è¯ä¹¦**: æ€§èƒ½æ›´å¥½ï¼Œå¯†é’¥æ›´å°ï¼Œå®‰å…¨æ€§æ›´é«˜
- **æ³›åŸŸåè¯ä¹¦**: æ¨èç”¨äºå¤šå­åŸŸååœºæ™¯ï¼Œç®¡ç†æ›´ä¾¿æ·
- **è‡ªåŠ¨ç»­æœŸ**: å»ºè®®æ‰€æœ‰è¯ä¹¦å¯ç”¨è‡ªåŠ¨ç»­æœŸ

#### ç›‘æ§å»ºè®®

- å®šæœŸæ£€æŸ¥è¯ä¹¦çŠ¶æ€ï¼š`docker exec acme-ssl-manager /scripts/cert-manager.sh status-all`
- ç›‘æ§ç³»ç»Ÿæ—¥å¿—ï¼š`docker exec acme-ssl-manager tail -f /data/logs/cert-manager.log`
- è®¾ç½®è¿‡æœŸæé†’ï¼šç³»ç»Ÿé»˜è®¤æå‰ 30 å¤©æé†’

### è‡ªåŠ¨åŒ–ä»»åŠ¡

ç³»ç»Ÿå·²é¢„é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼š

- **æ¯æ—¥å‡Œæ™¨ 2 ç‚¹**: ç›‘æ§è¯ä¹¦è¿‡æœŸçŠ¶æ€
- **æ¯æ—¥å‡Œæ™¨ 3 ç‚¹**: è‡ªåŠ¨ç»­æœŸå³å°†è¿‡æœŸçš„è¯ä¹¦
- **æ¯æ—¥ä¸Šåˆ 11 ç‚¹**: æ£€æŸ¥è¯ä¹¦çŠ¶æ€å¹¶å‘é€æŠ¥å‘Š
- **æ¯å‘¨æ—¥å‡Œæ™¨ 4 ç‚¹**: æ¸…ç†è¿‡æœŸæ—¥å¿—å’Œå¤‡ä»½

### å¤‡ä»½å’Œæ¢å¤

```bash
# å¤‡ä»½æ‰€æœ‰è¯ä¹¦
docker exec acme-ssl-manager /scripts/utils/backup.sh backup all

# æ¢å¤è¯ä¹¦
docker exec acme-ssl-manager /scripts/utils/backup.sh restore local api.example.com

# æ¸…ç†è¿‡æœŸå¤‡ä»½
docker exec acme-ssl-manager /scripts/utils/backup.sh cleanup 90
```

### é€šçŸ¥é…ç½®

æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼ï¼š

- é‚®ä»¶é€šçŸ¥
- é’‰é’‰é€šçŸ¥
- Webhook é€šçŸ¥
- Slack é€šçŸ¥
- çŸ­ä¿¡é€šçŸ¥

#### é…ç½®é€šçŸ¥

```bash
# å¤åˆ¶é€šçŸ¥é…ç½®æ¨¡æ¿
cp config/notify.yml.example config/notify.yml

# ç¼–è¾‘é€šçŸ¥é…ç½®
nano config/notify.yml
```

**é’‰é’‰é€šçŸ¥é…ç½®ç¤ºä¾‹ï¼š**

```yaml
notifications:
  dingtalk:
    enabled: true
    webhook_url: "https://oapi.dingtalk.com/robot/send"
    access_token: "your-access-token"
    secret: "your-secret"
```

**é‚®ä»¶é€šçŸ¥é…ç½®ç¤ºä¾‹ï¼š**

```yaml
notifications:
  email:
    enabled: true
    smtp:
      host: smtp.gmail.com
      port: 587
      user: your-email@gmail.com
      password: your-email-password
    from: ssl-manager@example.com
    to:
      - admin@example.com
```

**æµ‹è¯•é€šçŸ¥åŠŸèƒ½ï¼š**

```bash
# æµ‹è¯•æ‰€æœ‰é€šçŸ¥æ–¹å¼
docker exec acme-ssl-manager /scripts/utils/notify.sh test

# æµ‹è¯•ç‰¹å®šé€šçŸ¥æ–¹å¼
docker exec acme-ssl-manager /scripts/utils/notify.sh test dingtalk
```

## ğŸ”Œ API æ¥å£æ–‡æ¡£

ç³»ç»Ÿæä¾›å®Œæ•´çš„ REST API æ¥å£ï¼Œæ”¯æŒè¯ä¹¦ç®¡ç†ã€é…ç½®ç®¡ç†ã€æ—¥å¿—æŸ¥çœ‹ç­‰åŠŸèƒ½ã€‚

### API åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:5000/api`
- **Content-Type**: `application/json`
- **è®¤è¯**: æ— ï¼ˆå†…ç½‘ä½¿ç”¨ï¼‰

### 1. ä»ªè¡¨ç›˜æ¥å£

#### è·å–ä»ªè¡¨ç›˜ç»Ÿè®¡æ•°æ®

```
GET /api/dashboard
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "totalCerts": 12,
  "healthyCerts": 10,
  "expiringCerts": 2,
  "systemStatus": {
    "healthy": true,
    "message": "ç³»ç»Ÿè¿è¡Œæ­£å¸¸",
    "timestamp": "2025-07-15T10:30:00"
  }
}
```

### 2. è¯ä¹¦ç®¡ç†æ¥å£

#### è·å–è¯ä¹¦åˆ—è¡¨

```
GET /api/certificates
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "certificates": [
    {
      "domain": "example.com",
      "type": "wildcard",
      "algorithm": "ECC",
      "expiryDate": "2025-10-10",
      "daysRemaining": 87,
      "status": "healthy",
      "custom_configs": {
        "api.example.com": {
          "deploy_dir": "api.example.com",
          "cert_filename": "fullchain.cer",
          "key_filename": "example.com.key",
          "deploy_method": "auto"
        }
      }
    }
  ]
}
```

#### ç”Ÿæˆè¯ä¹¦

```
POST /api/certificates
Content-Type: application/json
```

**è¯·æ±‚å‚æ•°**:

| å‚æ•°        | ç±»å‹   | å¿…å¡« | è¯´æ˜                                            |
| ----------- | ------ | ---- | ----------------------------------------------- |
| domain      | String | âœ…   | åŸŸå                                            |
| certType    | String | âšª   | è¯ä¹¦ç±»å‹: `wildcard` æˆ– `single`ï¼Œé»˜è®¤ `single` |
| dnsProvider | String | âšª   | DNS æä¾›å•†ï¼Œé»˜è®¤ `aliyun`                       |

**è¯·æ±‚ç¤ºä¾‹**:

```json
{
  "domain": "example.com",
  "certType": "wildcard",
  "dnsProvider": "aliyun"
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è¯ä¹¦ç”ŸæˆæˆåŠŸ"
}
```

#### ç»­æœŸè¯ä¹¦

```
POST /api/certificates/{domain}/renew
```

**è·¯å¾„å‚æ•°**:

- `domain`: åŸŸå

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è¯ä¹¦ç»­æœŸæˆåŠŸ"
}
```

#### åˆ é™¤è¯ä¹¦

```
DELETE /api/certificates/{domain}
```

**è·¯å¾„å‚æ•°**:

- `domain`: åŸŸå

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "è¯ä¹¦åˆ é™¤æˆåŠŸ"
}
```

#### ä¸‹è½½è¯ä¹¦

```
GET /api/certificates/{domain}/download
```

**è·¯å¾„å‚æ•°**:

- `domain`: åŸŸå

**å“åº”**: ZIP æ–‡ä»¶æµ

### 3. æ‰‹åŠ¨éƒ¨ç½²åŸŸåæ¥å£

#### è·å–æ‰‹åŠ¨éƒ¨ç½²åŸŸååˆ—è¡¨

```
GET /api/certificates/manual
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "domains": [
    {
      "domain": "static.example.com",
      "parent_domain": "example.com",
      "deploy_method": "manual",
      "cert_exists": true,
      "expires": "2025-10-10",
      "status": "healthy",
      "cert_dir": "/data/certs/example.com_ecc",
      "description": "æ‰‹åŠ¨éƒ¨ç½²åŸŸå - static.example.com"
    }
  ]
}
```

#### ä¸‹è½½æ‰‹åŠ¨éƒ¨ç½²åŸŸåè¯ä¹¦

```
GET /api/certificates/manual/{domain}/download
```

**è·¯å¾„å‚æ•°**:

- `domain`: æ‰‹åŠ¨éƒ¨ç½²çš„åŸŸå

**å“åº”**: ZIP æ–‡ä»¶æµ

### 4. é…ç½®ç®¡ç†æ¥å£

#### è·å–é…ç½®

```
GET /api/config/{config_type}
```

**è·¯å¾„å‚æ•°**:

- `config_type`: é…ç½®ç±»å‹
  - `domains`: åŸŸåé…ç½®
  - `dns`: DNS æä¾›å•†é…ç½®
  - `servers`: æœåŠ¡å™¨é…ç½®
  - `notification`: é€šçŸ¥é…ç½®

**å“åº”ç¤ºä¾‹**:

```json
{
  "content": "domains:\n  - domain: example.com\n    ..."
}
```

#### ä¿å­˜é…ç½®

```
POST /api/config/{config_type}
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:

- `config_type`: é…ç½®ç±»å‹ï¼ˆåŒä¸Šï¼‰

**è¯·æ±‚å‚æ•°**:

```json
{
  "content": "domains:\n  - domain: example.com\n    ..."
}
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "é…ç½®ä¿å­˜æˆåŠŸ"
}
```

### 5. æ—¥å¿—ç®¡ç†æ¥å£

#### è·å–æ—¥å¿—

```
GET /api/logs/{log_type}
```

**è·¯å¾„å‚æ•°**:

- `log_type`: æ—¥å¿—ç±»å‹
  - `cert-manager`: è¯ä¹¦ç®¡ç†æ—¥å¿—
  - `error`: é”™è¯¯æ—¥å¿—
  - `cron`: å®šæ—¶ä»»åŠ¡æ—¥å¿—

**å“åº”ç¤ºä¾‹**:

```json
{
  "content": "[2025-07-15 10:30:00] [INFO] è¯ä¹¦ç”ŸæˆæˆåŠŸ: example.com\n..."
}
```

#### æ¸…ç©ºæ—¥å¿—

```
DELETE /api/logs/{log_type}
```

**è·¯å¾„å‚æ•°**:

- `log_type`: æ—¥å¿—ç±»å‹ï¼ˆåŒä¸Šï¼‰

**å“åº”ç¤ºä¾‹**:

```json
{
  "success": true,
  "message": "æ—¥å¿—æ¸…ç©ºæˆåŠŸ"
}
```

### 6. ç›‘æ§æ¥å£

#### è·å–ç›‘æ§æ•°æ®

```
GET /api/monitoring
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "uptime": "up 5 days, 3:42",
  "lastCheck": "2025-07-15 10:00:00",
  "certUpdates": 25,
  "charts": {}
}
```

### 7. å¥åº·æ£€æŸ¥æ¥å£

#### å¥åº·æ£€æŸ¥

```
GET /health
```

**å“åº”ç¤ºä¾‹**:

```json
{
  "status": "ok",
  "timestamp": "2025-07-15T10:30:00",
  "version": "1.0.0"
}
```

### API ä½¿ç”¨ç¤ºä¾‹

#### cURL ç¤ºä¾‹

**è·å–è¯ä¹¦åˆ—è¡¨**:

```bash
curl -X GET http://localhost:5000/api/certificates
```

**ç”Ÿæˆè¯ä¹¦**:

```bash
curl -X POST http://localhost:5000/api/certificates \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "example.com",
    "certType": "wildcard",
    "dnsProvider": "aliyun"
  }'
```

**ç»­æœŸè¯ä¹¦**:

```bash
curl -X POST http://localhost:5000/api/certificates/example.com/renew
```

**ä¸‹è½½è¯ä¹¦**:

```bash
curl -X GET http://localhost:5000/api/certificates/example.com/download \
  -o example.com_certificate.zip
```

#### Python ç¤ºä¾‹

```python
import requests
import json

# APIåŸºç¡€URL
BASE_URL = "http://localhost:5000/api"

# è·å–è¯ä¹¦åˆ—è¡¨
def get_certificates():
    response = requests.get(f"{BASE_URL}/certificates")
    return response.json()

# ç”Ÿæˆè¯ä¹¦
def create_certificate(domain, cert_type="wildcard", dns_provider="aliyun"):
    data = {
        "domain": domain,
        "certType": cert_type,
        "dnsProvider": dns_provider
    }
    response = requests.post(
        f"{BASE_URL}/certificates",
        headers={"Content-Type": "application/json"},
        data=json.dumps(data)
    )
    return response.json()

# ç»­æœŸè¯ä¹¦
def renew_certificate(domain):
    response = requests.post(f"{BASE_URL}/certificates/{domain}/renew")
    return response.json()

# ä¸‹è½½è¯ä¹¦
def download_certificate(domain, output_file):
    response = requests.get(f"{BASE_URL}/certificates/{domain}/download")
    with open(output_file, 'wb') as f:
        f.write(response.content)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    # è·å–è¯ä¹¦åˆ—è¡¨
    certs = get_certificates()
    print(f"æ€»è¯ä¹¦æ•°: {len(certs['certificates'])}")

    # ç”Ÿæˆæ–°è¯ä¹¦
    result = create_certificate("example.com", "wildcard", "aliyun")
    print(f"ç”Ÿæˆç»“æœ: {result['message']}")

    # ç»­æœŸè¯ä¹¦
    result = renew_certificate("example.com")
    print(f"ç»­æœŸç»“æœ: {result['message']}")

    # ä¸‹è½½è¯ä¹¦
    download_certificate("example.com", "example.com_cert.zip")
    print("è¯ä¹¦ä¸‹è½½å®Œæˆ")
```

#### JavaScript/Node.js ç¤ºä¾‹

```javascript
const axios = require("axios");
const fs = require("fs");

const BASE_URL = "http://localhost:5000/api";

// è·å–è¯ä¹¦åˆ—è¡¨
async function getCertificates() {
  const response = await axios.get(`${BASE_URL}/certificates`);
  return response.data;
}

// ç”Ÿæˆè¯ä¹¦
async function createCertificate(
  domain,
  certType = "wildcard",
  dnsProvider = "aliyun"
) {
  const response = await axios.post(`${BASE_URL}/certificates`, {
    domain,
    certType,
    dnsProvider,
  });
  return response.data;
}

// ç»­æœŸè¯ä¹¦
async function renewCertificate(domain) {
  const response = await axios.post(`${BASE_URL}/certificates/${domain}/renew`);
  return response.data;
}

// ä¸‹è½½è¯ä¹¦
async function downloadCertificate(domain, outputFile) {
  const response = await axios.get(
    `${BASE_URL}/certificates/${domain}/download`,
    {
      responseType: "stream",
    }
  );

  const writer = fs.createWriteStream(outputFile);
  response.data.pipe(writer);

  return new Promise((resolve, reject) => {
    writer.on("finish", resolve);
    writer.on("error", reject);
  });
}

// ä½¿ç”¨ç¤ºä¾‹
(async () => {
  try {
    // è·å–è¯ä¹¦åˆ—è¡¨
    const certs = await getCertificates();
    console.log(`æ€»è¯ä¹¦æ•°: ${certs.certificates.length}`);

    // ç”Ÿæˆæ–°è¯ä¹¦
    const createResult = await createCertificate(
      "example.com",
      "wildcard",
      "aliyun"
    );
    console.log(`ç”Ÿæˆç»“æœ: ${createResult.message}`);

    // ç»­æœŸè¯ä¹¦
    const renewResult = await renewCertificate("example.com");
    console.log(`ç»­æœŸç»“æœ: ${renewResult.message}`);

    // ä¸‹è½½è¯ä¹¦
    await downloadCertificate("example.com", "example.com_cert.zip");
    console.log("è¯ä¹¦ä¸‹è½½å®Œæˆ");
  } catch (error) {
    console.error("é”™è¯¯:", error.message);
  }
})();
```

### é”™è¯¯å¤„ç†

#### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "success": false,
  "message": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

#### HTTP çŠ¶æ€ç 

| çŠ¶æ€ç  | è¯´æ˜           |
| ------ | -------------- |
| 200    | è¯·æ±‚æˆåŠŸ       |
| 400    | è¯·æ±‚å‚æ•°é”™è¯¯   |
| 404    | èµ„æºä¸å­˜åœ¨     |
| 500    | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

### API å®‰å…¨å»ºè®®

1. **å†…ç½‘è®¿é—®**: é»˜è®¤é…ç½®ä»…å…è®¸å†…ç½‘è®¿é—®ï¼Œä¸å¯¹å¤–æš´éœ²
2. **è®¤è¯æœºåˆ¶**: ç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ è®¤è¯ä¸­é—´ä»¶
3. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPS
4. **è¯·æ±‚é™æµ**: å»ºè®®é…ç½® API è¯·æ±‚é™æµ
5. **æ—¥å¿—å®¡è®¡**: è®°å½•æ‰€æœ‰ API æ“ä½œæ—¥å¿—

---

## ğŸ“– è¯¦ç»†å®æˆ˜æŒ‡å—

### å®Œæ•´çš„åŸŸåè¯ä¹¦éƒ¨ç½²æµç¨‹

ä»¥æ³›åŸŸå `example-project.com` ä¸ºä¾‹ï¼Œæ¼”ç¤ºä»é…ç½®åˆ°éƒ¨ç½²çš„å®Œæ•´æµç¨‹ï¼š

#### æ­¥éª¤ 1ï¼šç³»ç»Ÿå¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# éªŒè¯ç³»ç»Ÿå¥åº·
docker exec acme-ssl-manager /scripts/cert-manager-simple.sh health-check
```

#### æ­¥éª¤ 2ï¼šç¡®è®¤é…ç½®æ–‡ä»¶

**DNS æä¾›å•†é…ç½®** (`config/dns-providers.yml`)ï¼š

```yaml
dns_providers:
  aliyun:
    provider_id: aliyun
    provider_name: "é˜¿é‡Œäº‘DNS"
    acme_dns_type: dns_ali
    env_vars:
      Ali_Key: "ä½ çš„é˜¿é‡Œäº‘AccessKey"
      Ali_Secret: "ä½ çš„é˜¿é‡Œäº‘Secret"
```

**åŸŸåé…ç½®** (`config/domains.yml`)ï¼š

```yaml
domains:
  - domain: example-project.com
    subdomains:
      - api.example-project.com
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_prod_02
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "æ”¿ç­–é€šåŠå¹³å°SSLè¯ä¹¦"
```

**æœåŠ¡å™¨é…ç½®** (`config/servers.yml`)ï¼š

```yaml
servers:
  - server_id: server_prod_02
    host: 203.0.113.10
    user: root
    ssl_cert_dir: /opt/docker/nginx/ssl
    nginx_container: nginx
    nginx_reload_cmd: docker restart nginx
    connection_timeout: 10
    description: "ä¸»è¦ç”Ÿäº§æœåŠ¡å™¨"
```

#### æ­¥éª¤ 3ï¼šç”Ÿæˆè¯ä¹¦

```bash
# ç”Ÿæˆæ³›åŸŸåè¯ä¹¦
docker exec acme-ssl-manager bash -c '
export Ali_Key="ä½ çš„é˜¿é‡Œäº‘AccessKey" &&
export Ali_Secret="ä½ çš„é˜¿é‡Œäº‘Secret" &&
/scripts/cert-manager.sh generate example-project.com'

# æ£€æŸ¥ç”Ÿæˆçš„è¯ä¹¦
docker exec acme-ssl-manager ls -la /data/certs/example-project.com_ecc/

# éªŒè¯è¯ä¹¦åŸŸåè¦†ç›–
docker exec acme-ssl-manager openssl x509 -in /data/certs/example-project.com_ecc/example-project.com.cer -text -noout | grep -A 2 "Subject Alternative Name"
```

#### æ­¥éª¤ 4ï¼šæ‰‹åŠ¨éƒ¨ç½²è¯ä¹¦ï¼ˆæ¨èï¼‰

è™½ç„¶ç³»ç»Ÿæä¾›è‡ªåŠ¨åŒ–éƒ¨ç½²åŠŸèƒ½ï¼Œä½†æ‰‹åŠ¨éƒ¨ç½²å¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¿‡ç¨‹ï¼š

```bash
# 1. æµ‹è¯•SSHè¿æ¥
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "echo 'SSHè¿æ¥æµ‹è¯•æˆåŠŸ'"

# 2. åˆ›å»ºç›®æ ‡ç›®å½•
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "mkdir -p /opt/docker/nginx/ssl/api.example-project.com"

# 3. å¤‡ä»½ç°æœ‰è¯ä¹¦
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "
cd /opt/docker/nginx/ssl/api.example-project.com &&
if [ -f example-project.com.cer ]; then
  cp example-project.com.cer example-project.com.cer.backup.\$(date +%Y%m%d%H%M%S)
fi &&
if [ -f example-project.com.key ]; then
  cp example-project.com.key example-project.com.key.backup.\$(date +%Y%m%d%H%M%S)
fi"

# 4. ä¸Šä¼ æ–°è¯ä¹¦
docker exec acme-ssl-manager scp -o ConnectTimeout=10 -o BatchMode=yes /data/certs/example-project.com_ecc/example-project.com.cer root@203.0.113.10:/opt/docker/nginx/ssl/api.example-project.com/

docker exec acme-ssl-manager scp -o ConnectTimeout=10 -o BatchMode=yes /data/certs/example-project.com_ecc/example-project.com.key root@203.0.113.10:/opt/docker/nginx/ssl/api.example-project.com/

# 5. è®¾ç½®æ­£ç¡®æƒé™
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "
chmod 644 /opt/docker/nginx/ssl/api.example-project.com/example-project.com.cer &&
chmod 600 /opt/docker/nginx/ssl/api.example-project.com/example-project.com.key"

# 6. éªŒè¯æ–‡ä»¶ä¸Šä¼ 
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "ls -la /opt/docker/nginx/ssl/api.example-project.com/"
```

#### æ­¥éª¤ 5ï¼šé‡å¯æœåŠ¡å¹¶éªŒè¯

```bash
# 1. æµ‹è¯•nginxé…ç½®
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "docker exec nginx nginx -t"

# 2. é‡å¯nginxå®¹å™¨
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "docker restart nginx"

# 3. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "docker ps | grep nginx"

# 4. éªŒè¯SSLè¯ä¹¦
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "echo | openssl s_client -connect api.example-project.com:443 -servername api.example-project.com 2>/dev/null | openssl x509 -noout -subject -issuer -dates"

# 5. æµ‹è¯•HTTPSè¿æ¥
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 -o BatchMode=yes root@203.0.113.10 "curl -I -k https://api.example-project.com --connect-timeout 10"
```

#### æ­¥éª¤ 6ï¼šé…ç½®è‡ªåŠ¨æ›´æ–°

**æ–¹æ³• 1ï¼šä½¿ç”¨å†…ç½®å®šæ—¶ä»»åŠ¡**

ç³»ç»Ÿå·²é¢„é…ç½®è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼š

- æ¯æ—¥å‡Œæ™¨ 2 ç‚¹ï¼šç›‘æ§è¯ä¹¦è¿‡æœŸçŠ¶æ€
- æ¯æ—¥å‡Œæ™¨ 3 ç‚¹ï¼šè‡ªåŠ¨ç»­æœŸå³å°†è¿‡æœŸçš„è¯ä¹¦
- æ¯æ—¥ä¸Šåˆ 11 ç‚¹ï¼šæ£€æŸ¥è¯ä¹¦çŠ¶æ€å¹¶å‘é€æŠ¥å‘Š
- æ¯å‘¨æ—¥å‡Œæ™¨ 4 ç‚¹ï¼šæ¸…ç†è¿‡æœŸæ—¥å¿—å’Œå¤‡ä»½

**æ–¹æ³• 2ï¼šè‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡**

å¦‚éœ€è‡ªå®šä¹‰ï¼Œå¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ·»åŠ å®šæ—¶ä»»åŠ¡ï¼š

```bash
# åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ·»åŠ cronä»»åŠ¡
# æ¯æœˆ1å·å‡Œæ™¨2ç‚¹è‡ªåŠ¨æ›´æ–°è¯ä¹¦
0 2 1 * * /usr/local/bin/cert-update.sh example-project.com

# åˆ›å»ºæ›´æ–°è„šæœ¬
cat > /usr/local/bin/cert-update.sh << 'EOF'
#!/bin/bash
DOMAIN="$1"
LOG_FILE="/var/log/cert-update.log"

echo "[$(date)] å¼€å§‹æ›´æ–°è¯ä¹¦: $DOMAIN" >> $LOG_FILE

# è¿™é‡Œå¯ä»¥è°ƒç”¨ACMEç³»ç»Ÿçš„APIæˆ–æ‰§è¡Œè¿œç¨‹å‘½ä»¤
# æˆ–è€…æ¥æ”¶æ¥è‡ªACMEç³»ç»Ÿæ¨é€çš„æ–°è¯ä¹¦

echo "[$(date)] è¯ä¹¦æ›´æ–°å®Œæˆ: $DOMAIN" >> $LOG_FILE
EOF

chmod +x /usr/local/bin/cert-update.sh
```

**æ–¹æ³• 3ï¼šä½¿ç”¨ Webhook é€šçŸ¥**

é…ç½®è¯ä¹¦æ›´æ–°æˆåŠŸåçš„è‡ªåŠ¨é€šçŸ¥ï¼š

```yaml
# åœ¨ config/notify.yml ä¸­é…ç½®
notifications:
  webhook:
    url: "https://your-api.com/cert-updated"
    method: "POST"
    headers:
      Authorization: "Bearer your-token"
    body:
      domain: "{{domain}}"
      status: "{{status}}"
      expires: "{{expires}}"
```

#### éªŒè¯ç»“æœ

æˆåŠŸéƒ¨ç½²åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. **è¯ä¹¦ä¿¡æ¯éªŒè¯**ï¼š

   ```
   subject= /CN=example-project.com
   issuer= /C=US/O=Let's Encrypt/CN=E6
   notBefore=Jul 12 04:05:12 2025 GMT
   notAfter=Oct 10 04:05:11 2025 GMT
   ```

2. **åŸŸåè¦†ç›–ç¡®è®¤**ï¼š

   ```
   X509v3 Subject Alternative Name:
       DNS:*.example-project.com, DNS:example-project.com
   ```

3. **HTTPS å“åº”æ­£å¸¸**ï¼š
   ```
   HTTP/1.1 200 OK
   Server: nginx
   ```

### å•åŸŸå vs æ³›åŸŸåé€‰æ‹©

**æ³›åŸŸåè¯ä¹¦** (æ¨è)ï¼š

- âœ… è¦†ç›–æ‰€æœ‰å­åŸŸå (`*.example.com`)
- âœ… ç®¡ç†ç®€å•ï¼Œä¸€ä¸ªè¯ä¹¦ç®¡ç†å¤šä¸ªæœåŠ¡
- âœ… æˆæœ¬æ•ˆç›Šé«˜
- âŒ å®‰å…¨æ€§ç¨ä½ï¼ˆä¸€ä¸ªç§é’¥å¯¹åº”å¤šä¸ªåŸŸåï¼‰

**å•åŸŸåè¯ä¹¦**ï¼š

- âœ… å®‰å…¨æ€§æ›´é«˜ï¼ˆæ¯ä¸ªåŸŸåç‹¬ç«‹ç§é’¥ï¼‰
- âœ… å½±å“èŒƒå›´å°
- âŒ ç®¡ç†å¤æ‚ï¼ˆéœ€è¦ä¸ºæ¯ä¸ªå­åŸŸåç”³è¯·è¯ä¹¦ï¼‰
- âŒ è¯ä¹¦æ•°é‡å¤š

### æœ€ä½³å®è·µå»ºè®®

1. **åˆæ¬¡éƒ¨ç½²**ï¼š

   - å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å®Œæ•´æµç¨‹
   - ç¡®è®¤ nginx é…ç½®æ–‡ä»¶è·¯å¾„æ­£ç¡®
   - æµ‹è¯• SSH è¿æ¥å’Œæƒé™

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼š

   - ä½¿ç”¨æ³›åŸŸåè¯ä¹¦ç®€åŒ–ç®¡ç†
   - è®¾ç½®è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤æœºåˆ¶
   - é…ç½®ç›‘æ§å’Œå‘Šè­¦

3. **å®‰å…¨è€ƒè™‘**ï¼š

   - å®šæœŸè½®æ¢ API å¯†é’¥
   - é™åˆ¶ SSH è®¿é—®æƒé™
   - ç›‘æ§è¯ä¹¦ä½¿ç”¨æƒ…å†µ

4. **ç»´æŠ¤ç®¡ç†**ï¼š
   - å®šæœŸæ£€æŸ¥è¯ä¹¦è¿‡æœŸæ—¶é—´
   - æ¸…ç†è¿‡æœŸçš„å¤‡ä»½æ–‡ä»¶
   - æ›´æ–°ç³»ç»Ÿç»„ä»¶

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. DNS API è®¤è¯å¤±è´¥

```bash
# æ£€æŸ¥é…ç½®
docker exec acme-ssl-manager cat /config/dns-providers.yml

# æµ‹è¯•è¿æ¥
docker exec acme-ssl-manager /scripts/cert-manager.sh test-dns aliyun
```

#### 2. è¯ä¹¦ç”Ÿæˆå¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
docker exec acme-ssl-manager tail -f /data/logs/cert-manager.log

# æ£€æŸ¥åŸŸåè§£æ
docker exec acme-ssl-manager nslookup api.example.com
```

#### 3. è¯ä¹¦éƒ¨ç½²å¤±è´¥

```bash
# æ£€æŸ¥ SSH è¿æ¥
docker exec acme-ssl-manager ssh -o ConnectTimeout=10 root@target-server "echo 'SSH OK'"

# æ£€æŸ¥ç›®æ ‡ç›®å½•
ssh root@target-server "ls -la /opt/docker/nginx/ssl/"
```

#### 4. æœåŠ¡é‡å¯å¤±è´¥

```bash
# æ£€æŸ¥ nginx é…ç½®
ssh root@target-server "nginx -t"

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
ssh root@target-server "docker ps | grep nginx"
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker exec acme-ssl-manager tail -f /data/logs/cert-manager.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker exec acme-ssl-manager tail -f /data/logs/cert-manager-error.log

# æœç´¢ç‰¹å®šé”™è¯¯
docker exec acme-ssl-manager grep "ERROR" /data/logs/cert-manager.log
```

## ğŸ“‹ é…ç½®ç¤ºä¾‹å‚è€ƒ

### ç¤ºä¾‹ 1ï¼šæ”¿ç­–é€šåŠåŸŸåï¼ˆå·²æµ‹è¯•æˆåŠŸï¼‰

**åŸŸåé…ç½®**ï¼š

```yaml
domains:
  - domain: example-project.com
    subdomains:
      - api.example-project.com
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_prod_02
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "æ”¿ç­–é€šåŠå¹³å°SSLè¯ä¹¦"
```

**æœåŠ¡å™¨é…ç½®**ï¼š

```yaml
servers:
  - server_id: server_prod_02
    host: 203.0.113.10
    user: root
    ssl_cert_dir: /opt/docker/nginx/ssl
    nginx_reload_cmd: docker restart nginx
```

**éƒ¨ç½²å‘½ä»¤**ï¼š

```bash
# ç”Ÿæˆæ³›åŸŸåè¯ä¹¦
docker exec acme-ssl-manager bash -c 'export Ali_Key="ä½ çš„Key" && export Ali_Secret="ä½ çš„Secret" && /scripts/cert-manager.sh generate example-project.com'

# æ‰‹åŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰
# 1. åˆ›å»ºç›®å½•
docker exec acme-ssl-manager ssh root@203.0.113.10 "mkdir -p /opt/docker/nginx/ssl/api.example-project.com"

# 2. ä¸Šä¼ è¯ä¹¦
docker exec acme-ssl-manager scp /data/certs/example-project.com_ecc/example-project.com.cer root@203.0.113.10:/opt/docker/nginx/ssl/api.example-project.com/
docker exec acme-ssl-manager scp /data/certs/example-project.com_ecc/example-project.com.key root@203.0.113.10:/opt/docker/nginx/ssl/api.example-project.com/

# 3. é‡å¯æœåŠ¡
docker exec acme-ssl-manager ssh root@203.0.113.10 "docker restart nginx"
```

### ç¤ºä¾‹ 2ï¼šCC æ‹›è½¦åŸŸåé…ç½®

**åŸŸåé…ç½®**ï¼š

```yaml
domains:
  - domain: example-app.com
    subdomains:
      - www.example-app.com
      - lightapi.example-app.com
      - pre.example-app.com
      - mch.example-app.com
      - fapiao.example-app.com
    wildcard: true
    dns_provider: aliyun
    servers:
      - server_prod_01
      - server_prod_02
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "å¹³å°SSLè¯ä¹¦"
```

**éƒ¨ç½²åˆ°å¤šæœåŠ¡å™¨**ï¼š

```bash
# ç”Ÿæˆè¯ä¹¦
docker exec acme-ssl-manager bash -c 'export Ali_Key="ä½ çš„Key" && export Ali_Secret="ä½ çš„Secret" && /scripts/cert-manager.sh generate example-app.com'

# éƒ¨ç½²åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨
docker exec acme-ssl-manager scp /data/certs/example-app.com_ecc/example-app.com.cer root@203.0.113.20:/mnt/nginx/cert/
docker exec acme-ssl-manager scp /data/certs/example-app.com_ecc/example-app.com.key root@203.0.113.20:/mnt/nginx/cert/
docker exec acme-ssl-manager ssh root@203.0.113.20 "nginx -s reload"

# éƒ¨ç½²åˆ°ç¬¬äºŒå°æœåŠ¡å™¨
docker exec acme-ssl-manager scp /data/certs/example-app.com_ecc/example-app.com.cer root@203.0.113.10:/opt/docker/nginx/ssl/example-app/
docker exec acme-ssl-manager scp /data/certs/example-app.com_ecc/example-app.com.key root@203.0.113.10:/opt/docker/nginx/ssl/example-app/
docker exec acme-ssl-manager ssh root@203.0.113.10 "docker restart nginx"
```

### ç¤ºä¾‹ 3ï¼šè…¾è®¯äº‘ DNS åŸŸåé…ç½®

**DNS æä¾›å•†é…ç½®**ï¼š

```yaml
dns_providers:
  tencent:
    provider_id: tencent
    provider_name: "è…¾è®¯äº‘DNS"
    acme_dns_type: dns_dp
    env_vars:
      DP_Id: "ä½ çš„è…¾è®¯äº‘SecretId"
      DP_Key: "ä½ çš„è…¾è®¯äº‘SecretKey"
```

**åŸŸåé…ç½®**ï¼š

```yaml
domains:
  - domain: example-business.com
    subdomains:
      - api.app.example-business.com
      - service.example-business.com
      - host.example-business.com
    wildcard: true
    dns_provider: tencent
    servers:
      - server_190_164
      - server_108_14_117
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "Higgseså¹³å°SSLè¯ä¹¦"
```

**éƒ¨ç½²å‘½ä»¤**ï¼š

```bash
# ä½¿ç”¨è…¾è®¯äº‘DNSç”Ÿæˆè¯ä¹¦
docker exec acme-ssl-manager bash -c 'export DP_Id="ä½ çš„Id" && export DP_Key="ä½ çš„Key" && /scripts/cert-manager.sh generate example-business.com'
```

### åº”ç”¨åˆ°å…¶ä»–åŸŸåçš„é€šç”¨æ­¥éª¤

åŸºäºä¸Šè¿°æˆåŠŸç»éªŒï¼Œæ›´æ–°å…¶ä»–åŸŸåè¯ä¹¦çš„é€šç”¨æµç¨‹ï¼š

#### 1. ä¿®æ”¹é…ç½®æ–‡ä»¶

**æ·»åŠ æ–°åŸŸååˆ° `config/domains.yml`**ï¼š

```yaml
domains:
  # æ·»åŠ ä½ çš„æ–°åŸŸå
  - domain: your-domain.com
    subdomains:
      - api.your-domain.com
      - www.your-domain.com
    wildcard: true # æ¨èä½¿ç”¨æ³›åŸŸå
    dns_provider: aliyun # æˆ– tencent
    servers:
      - your_server_id
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "ä½ çš„åŸŸåSSLè¯ä¹¦"
```

**æ·»åŠ æœåŠ¡å™¨é…ç½®åˆ° `config/servers.yml`**ï¼š

```yaml
servers:
  - server_id: your_server_id
    host: your.server.ip
    user: root
    ssl_cert_dir: /path/to/your/ssl/dir
    nginx_container: your-nginx-container
    nginx_reload_cmd: docker restart your-nginx-container
    connection_timeout: 10
    description: "ä½ çš„æœåŠ¡å™¨"
```

#### 2. ç”Ÿæˆè¯ä¹¦

```bash
# æ›¿æ¢ä¸ºä½ çš„åŸŸåå’ŒAPIå¯†é’¥
docker exec acme-ssl-manager bash -c '
export Ali_Key="ä½ çš„é˜¿é‡Œäº‘AccessKey" &&
export Ali_Secret="ä½ çš„é˜¿é‡Œäº‘Secret" &&
/scripts/cert-manager.sh generate your-domain.com'
```

#### 3. éƒ¨ç½²è¯ä¹¦

```bash
# 1. æµ‹è¯•è¿æ¥
docker exec acme-ssl-manager ssh root@your.server.ip "echo 'SSHæµ‹è¯•æˆåŠŸ'"

# 2. åˆ›å»ºç›®å½•
docker exec acme-ssl-manager ssh root@your.server.ip "mkdir -p /path/to/your/ssl/dir"

# 3. å¤‡ä»½ç°æœ‰è¯ä¹¦
docker exec acme-ssl-manager ssh root@your.server.ip "
cd /path/to/your/ssl/dir &&
if [ -f your-domain.com.cer ]; then
  cp your-domain.com.cer your-domain.com.cer.backup.\$(date +%Y%m%d%H%M%S)
fi"

# 4. ä¸Šä¼ æ–°è¯ä¹¦
docker exec acme-ssl-manager scp /data/certs/your-domain.com_ecc/your-domain.com.cer root@your.server.ip:/path/to/your/ssl/dir/
docker exec acme-ssl-manager scp /data/certs/your-domain.com_ecc/your-domain.com.key root@your.server.ip:/path/to/your/ssl/dir/

# 5. è®¾ç½®æƒé™
docker exec acme-ssl-manager ssh root@your.server.ip "
chmod 644 /path/to/your/ssl/dir/your-domain.com.cer &&
chmod 600 /path/to/your/ssl/dir/your-domain.com.key"

# 6. é‡å¯æœåŠ¡
docker exec acme-ssl-manager ssh root@your.server.ip "docker restart your-nginx-container"
```

#### 4. éªŒè¯éƒ¨ç½²

```bash
# éªŒè¯è¯ä¹¦
docker exec acme-ssl-manager ssh root@your.server.ip "echo | openssl s_client -connect your-domain.com:443 -servername your-domain.com 2>/dev/null | openssl x509 -noout -subject -dates"

# æµ‹è¯•HTTPS
docker exec acme-ssl-manager ssh root@your.server.ip "curl -I -k https://your-domain.com --connect-timeout 10"
```

### æ‰¹é‡æ›´æ–°æ‰€æœ‰åŸŸå

å½“ä½ é…ç½®å¥½æ‰€æœ‰åŸŸååï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¹é‡æ“ä½œï¼š

```bash
# ç”Ÿæˆæ‰€æœ‰é…ç½®çš„è¯ä¹¦ï¼ˆåŒ…æ‹¬ deploy_method: manual çš„åŸŸåï¼‰
docker exec acme-ssl-manager /scripts/cert-manager.sh generate-all

# éƒ¨ç½²æ‰€æœ‰è¯ä¹¦ï¼ˆè‡ªåŠ¨è·³è¿‡ deploy_method: manual çš„åŸŸåï¼‰
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy-all

# æŸ¥çœ‹æ‰€æœ‰è¯ä¹¦çŠ¶æ€
docker exec acme-ssl-manager /scripts/cert-manager.sh status-all

# ç»­æœŸæ‰€æœ‰å³å°†è¿‡æœŸçš„è¯ä¹¦
docker exec acme-ssl-manager /scripts/cert-manager.sh renew-all

# æŸ¥çœ‹éœ€è¦æ‰‹åŠ¨å¤„ç†çš„åŸŸå
docker exec acme-ssl-manager /scripts/cert-manager.sh list-manual
```

#### ğŸ”§ æ‰¹é‡å¤„ç†è¡Œä¸ºè¯´æ˜

- **è¯ä¹¦ç”Ÿæˆ**: æ‰€æœ‰åŸŸåçš„è¯ä¹¦éƒ½ä¼šç”Ÿæˆï¼Œä¸å— `deploy_method` å½±å“
- **è¯ä¹¦éƒ¨ç½²**: åªæœ‰ `deploy_method: auto` çš„åŸŸåä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œ`deploy_method: manual` çš„åŸŸåä¼šè¢«è·³è¿‡
- **æ‰‹åŠ¨å¤„ç†**: è®¾ç½®ä¸º `manual` çš„åŸŸåéœ€è¦æ‰‹åŠ¨ä¸‹è½½è¯ä¹¦å¹¶ä¸Šä¼ åˆ°ç›¸åº”çš„ CDN å¹³å°

#### ğŸ” æ‰‹åŠ¨åŸŸåå¤„ç†

å¯¹äº `deploy_method: manual` çš„åŸŸåï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š

**1. æŸ¥çœ‹æ‰‹åŠ¨åŸŸååˆ—è¡¨**ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰éœ€è¦æ‰‹åŠ¨å¤„ç†çš„åŸŸå
docker exec acme-ssl-manager /scripts/cert-manager.sh list-manual
```

**2. ä¸‹è½½è¯ä¹¦æ–‡ä»¶**ï¼š

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å®¹å™¨å†…è·¯å¾„
docker exec acme-ssl-manager cp /data/certs/static.example.com_ecc/fullchain.cer /tmp/
docker exec acme-ssl-manager cp /data/certs/static.example.com_ecc/static.example.com.key /tmp/

# æ–¹æ³•2ï¼šç›´æ¥ä»å®¹å™¨ä¸­å¯¼å‡ºè¯ä¹¦
docker cp acme-ssl-manager:/data/certs/static.example.com_ecc/fullchain.cer ./
docker cp acme-ssl-manager:/data/certs/static.example.com_ecc/static.example.com.key ./
```

**3. æ‰‹åŠ¨ä¸Šä¼ åˆ° CDN å¹³å°**ï¼š

æ ¹æ®å…·ä½“ CDN å¹³å°çš„æ“ä½œç•Œé¢å®Œæˆä¸Šä¼ ï¼š

- **ä¸ƒç‰›äº‘ CDN**: æ§åˆ¶å° â†’ åŸŸåç®¡ç† â†’ SSL è¯ä¹¦ â†’ ä¸Šä¼ è¯ä¹¦
- **é˜¿é‡Œäº‘ CDN**: æ§åˆ¶å° â†’ åŸŸåç®¡ç† â†’ HTTPS é…ç½® â†’ ä¿®æ”¹é…ç½®
- **è…¾è®¯äº‘ CDN**: æ§åˆ¶å° â†’ åŸŸåç®¡ç† â†’ é«˜çº§é…ç½® â†’ HTTPS é…ç½®

**4. ä½¿ç”¨ Web ç®¡ç†ç•Œé¢**ï¼š

é€šè¿‡ Web ç•Œé¢ http://localhost:8080 ç®¡ç†æ‰‹åŠ¨åŸŸåï¼š

- æŸ¥çœ‹æ‰‹åŠ¨åŸŸååˆ—è¡¨
- ä¸‹è½½è¯ä¹¦æ–‡ä»¶
- æŸ¥çœ‹ CDN é…ç½®æŒ‡å—

## ğŸ”§ ç³»ç»Ÿæ¶æ„

```
acme/
â”œâ”€â”€ README.md                 # æœ¬æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml        # æœåŠ¡é…ç½®
â”œâ”€â”€ Dockerfile                # é•œåƒæ„å»º
â”œâ”€â”€ config/                   # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ *.yml.example        # é…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ *.yml                # å®é™…é…ç½®ï¼ˆgitå¿½ç•¥ï¼‰
â”œâ”€â”€ scripts/                  # æ ¸å¿ƒè„šæœ¬
â”‚   â”œâ”€â”€ cert-manager.sh      # å®Œæ•´ç‰ˆè¯ä¹¦ç®¡ç†
â”‚   â”œâ”€â”€ cert-manager-simple.sh  # ç®€åŒ–ç‰ˆçŠ¶æ€æŸ¥çœ‹
â”‚   â””â”€â”€ utils/               # å·¥å…·è„šæœ¬
â”œâ”€â”€ data/                     # è¿è¡Œæ—¶æ•°æ®ï¼ˆgitå¿½ç•¥ï¼‰
â”‚   â”œâ”€â”€ certs/              # è¯ä¹¦æ–‡ä»¶
â”‚   â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ backups/            # å¤‡ä»½æ–‡ä»¶
â”œâ”€â”€ web/                     # Webç•Œé¢
â””â”€â”€ monitoring/              # ç›‘æ§é…ç½®
```

## ğŸ”§ ç³»ç»Ÿç‰¹æ€§

### è¯ä¹¦æ ¼å¼æ”¯æŒ

ç³»ç»Ÿæ”¯æŒå¤šç§è¯ä¹¦æ ¼å¼ï¼š

- **ECC è¯ä¹¦** (æ¨è): æ€§èƒ½æ›´å¥½ï¼Œå¯†é’¥æ›´å°
- **RSA è¯ä¹¦**: å…¼å®¹æ€§æ›´å¥½

è¯ä¹¦æ–‡ä»¶è‡ªåŠ¨å­˜å‚¨åœ¨ï¼š

- ECC è¯ä¹¦: `/data/certs/domain.com_ecc/`
- RSA è¯ä¹¦: `/data/certs/domain.com/`

### çŠ¶æ€æ£€æŸ¥ä¼˜åŒ–

- è‡ªåŠ¨æ£€æµ‹è¯ä¹¦ç±»å‹ï¼ˆECC/RSAï¼‰
- æ™ºèƒ½æ—¥æœŸæ ¼å¼è§£æï¼Œå…¼å®¹ä¸åŒç³»ç»Ÿ
- é”™è¯¯å®¹é”™æœºåˆ¶ï¼Œç¡®ä¿æ‰€æœ‰åŸŸåéƒ½è¢«æ£€æŸ¥

### å…¼å®¹æ€§æ”¹è¿›

- æ”¯æŒ BusyBox ç¯å¢ƒçš„æ—¥æœŸå‘½ä»¤
- è‡ªåŠ¨å¤„ç† OpenSSL æ—¥æœŸæ ¼å¼è½¬æ¢
- å¢å¼ºçš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ”§ è¯ä¹¦é“¾å®Œæ•´æ€§ä¿éšœ

### æ–°å¢åŠŸèƒ½ï¼šè¯ä¹¦é“¾éªŒè¯

ä¸ºé˜²æ­¢ SSL è¯ä¹¦ä¿¡ä»»é—®é¢˜ï¼ˆå¦‚å¾®ä¿¡å°ç¨‹åºéªŒè¯å¤±è´¥ï¼‰ï¼Œç³»ç»Ÿç°åœ¨åŒ…å«å®Œæ•´çš„è¯ä¹¦é“¾éªŒè¯åŠŸèƒ½ï¼š

#### 1. è‡ªåŠ¨éªŒè¯æœºåˆ¶

**éƒ¨ç½²æ—¶è‡ªåŠ¨éªŒè¯**ï¼š

```bash
# éƒ¨ç½²è¯ä¹¦æ—¶è‡ªåŠ¨éªŒè¯è¯ä¹¦é“¾
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy example-project.com server_prod_02
```

éƒ¨ç½²è¿‡ç¨‹ä¼šè‡ªåŠ¨ï¼š

- âœ… éªŒè¯æœ¬åœ°è¯ä¹¦é“¾å®Œæ•´æ€§
- âœ… ç¡®ä¿ä½¿ç”¨ `fullchain.cer`ï¼ˆå®Œæ•´è¯ä¹¦é“¾ï¼‰
- âœ… éªŒè¯è¿œç¨‹éƒ¨ç½²åçš„è¯ä¹¦é“¾
- âœ… æ£€æŸ¥è¯ä¹¦å¯ä¿¡åº¦

#### 2. æ‰‹åŠ¨éªŒè¯å‘½ä»¤

**éªŒè¯æ‰€æœ‰åŸŸåçš„è¯ä¹¦é“¾**ï¼š

```bash
# æ£€æŸ¥æ‰€æœ‰åŸŸåçš„è¯ä¹¦é“¾çŠ¶æ€
docker exec acme-ssl-manager /scripts/cert-manager.sh verify-chains
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ“‹ SSLè¯ä¹¦é“¾å®Œæ•´æ€§éªŒè¯æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… example-project.com: å®Œæ•´è¯ä¹¦é“¾ (2 ä¸ªè¯ä¹¦) - fullchain.cer
   ğŸ“… è¿‡æœŸæ—¶é—´: Oct 10 04:05:11 2025 GMT

âš ï¸  example.com: ä¸å®Œæ•´è¯ä¹¦é“¾ (1 ä¸ªè¯ä¹¦) - example.com.cer
   ğŸ“ å»ºè®®: ä½¿ç”¨ fullchain.cer æ–‡ä»¶åŒ…å«å®Œæ•´è¯ä¹¦é“¾

ğŸ“Š ç»Ÿè®¡ç»“æœ:
â€¢ æ€»åŸŸåæ•°: 12
â€¢ å®Œæ•´è¯ä¹¦é“¾: 7
â€¢ ä¸å®Œæ•´è¯ä¹¦é“¾: 0
â€¢ ç¼ºå¤±è¯ä¹¦: 5
```

#### 3. è¯ä¹¦é“¾é‡è¦æ€§

**å®Œæ•´è¯ä¹¦é“¾çš„å¿…è¦æ€§**ï¼š

- ğŸ” **å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ€§**ï¼šå¾®ä¿¡å°ç¨‹åºéœ€è¦å®Œæ•´è¯ä¹¦é“¾éªŒè¯
- ğŸ” **ç§»åŠ¨ç«¯åº”ç”¨æ”¯æŒ**ï¼šiOS/Android åº”ç”¨éœ€è¦å®Œæ•´è¯ä¹¦é“¾
- ğŸ” **æµè§ˆå™¨å…¼å®¹æ€§**ï¼šç¡®ä¿æ‰€æœ‰æµè§ˆå™¨éƒ½èƒ½éªŒè¯è¯ä¹¦
- ğŸ” **API å®¢æˆ·ç«¯æ”¯æŒ**ï¼šç¬¬ä¸‰æ–¹ API å®¢æˆ·ç«¯éœ€è¦å®Œæ•´è¯ä¹¦é“¾

**è¯ä¹¦é“¾ç»“æ„**ï¼š

```
å®Œæ•´è¯ä¹¦é“¾ (fullchain.cer):
1. æœåŠ¡å™¨è¯ä¹¦ (ä½ çš„åŸŸåè¯ä¹¦)
2. ä¸­é—´è¯ä¹¦ (Let's Encrypt ä¸­é—´CA)
3. æ ¹è¯ä¹¦ (Let's Encrypt æ ¹CA, å¯é€‰)
```

#### 4. ä¿®å¤ä¸å®Œæ•´è¯ä¹¦é“¾

å¦‚æœå‘ç°è¯ä¹¦é“¾ä¸å®Œæ•´ï¼š

**æ–¹æ³• 1ï¼šé‡æ–°ç”Ÿæˆè¯ä¹¦**

```bash
# é‡æ–°ç”Ÿæˆè¯ä¹¦ï¼ˆè‡ªåŠ¨åŒ…å«å®Œæ•´è¯ä¹¦é“¾ï¼‰
docker exec acme-ssl-manager /scripts/cert-manager.sh generate example-project.com
```

**æ–¹æ³• 2ï¼šé‡æ–°éƒ¨ç½²ç°æœ‰è¯ä¹¦**

```bash
# é‡æ–°éƒ¨ç½²ï¼ˆç¡®ä¿ä½¿ç”¨fullchain.cerï¼‰
docker exec acme-ssl-manager /scripts/cert-manager.sh deploy example-project.com server_prod_02
```

**æ–¹æ³• 3ï¼šæ‰‹åŠ¨ä¿®å¤**

```bash
# 1. å¤‡ä»½ç°æœ‰è¯ä¹¦
cp example-project.com.cer example-project.com.cer.backup

# 2. ä½¿ç”¨å®Œæ•´è¯ä¹¦é“¾
cp fullchain.cer example-project.com.cer

# 3. é‡å¯æœåŠ¡
docker restart nginx
```

#### 5. éªŒè¯ä¿®å¤ç»“æœ

**æµ‹è¯•è¯ä¹¦é“¾**ï¼š

```bash
# æ£€æŸ¥è¯ä¹¦é“¾æ•°é‡
echo | openssl s_client -connect api.example-project.com:443 -showcerts 2>/dev/null | grep -c 'BEGIN CERTIFICATE'
# ç»“æœåº”è¯¥æ˜¯ 2 æˆ–æ›´å¤š

# æ£€æŸ¥è¯ä¹¦ä¿¡ä»»
echo | openssl s_client -connect api.example-project.com:443 -verify_return_error 2>/dev/null | grep "Verify return code"
# ç»“æœåº”è¯¥æ˜¯ "Verify return code: 0 (ok)"
```

**å¾®ä¿¡å°ç¨‹åºæµ‹è¯•**ï¼š

- åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯• API è¯·æ±‚
- ç¡®ä¿ä¸å†å‡ºç° `ERR_CERT_AUTHORITY_INVALID` é”™è¯¯

### ğŸš¨ æ•…éšœæ’é™¤

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v1.2.0 (2025-07-15)

**é‡å¤§ä¿®å¤**:

- ğŸ”§ **ä¿®å¤ DNS ç¯å¢ƒå˜é‡è®¾ç½®é—®é¢˜**ï¼šä¿®å¤ `setup_dns_provider_env` å‡½æ•°ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŸæ¥çš„ `^[A-Z_]+:` æ— æ³•åŒ¹é…åŒ…å«æ•°å­—çš„ç¯å¢ƒå˜é‡åï¼ˆå¦‚ `DP_Id`ã€`DP_Key`ã€`Ali_Key`ï¼‰ï¼Œç°å·²ä¿®å¤ä¸º `^[A-Za-z_][A-Za-z0-9_]*:`
- ğŸ› ï¸ **è§£å†³ ARM64 æ¶æ„å…¼å®¹æ€§é—®é¢˜**ï¼šåœ¨ ARM64 å®¿ä¸»æœºï¼ˆå¦‚ Apple Silicon Macï¼‰ä¸Šè¿è¡Œ x86_64 å®¹å™¨æ—¶ï¼ŒOpenSSL çš„ ECC å¯†é’¥ç”Ÿæˆä¼šå‡ºç°"Illegal instruction"é”™è¯¯ï¼Œç°å·²é»˜è®¤ä½¿ç”¨ RSA 2048 ä½å¯†é’¥ç¡®ä¿å…¼å®¹æ€§
- âš¡ **ä¿®å¤å¼ºåˆ¶æ›´æ–°é€‰é¡¹**ï¼šä¿®å¤ `--force` å’Œ `-f` å‚æ•°è§£æå’Œä¼ é€’é—®é¢˜

**æ–°å¢ç‰¹æ€§**:

- âœ… æ”¯æŒ `ACME_KEY_TYPE` ç¯å¢ƒå˜é‡æ§åˆ¶å¯†é’¥ç±»å‹ï¼ˆrsa/eccï¼‰
- âœ… æ–°å¢è°ƒè¯•æ—¥å¿—ï¼Œæ˜¾ç¤ºç¯å¢ƒå˜é‡è®¾ç½®å’Œå¯†é’¥ç±»å‹é€‰æ‹©
- âœ… æ™ºèƒ½å¯†é’¥ç±»å‹é€‰æ‹©ï¼Œé»˜è®¤ä½¿ç”¨ RSA ç¡®ä¿æœ€ä½³å…¼å®¹æ€§

**æ€§èƒ½ä¼˜åŒ–**:

- âš¡ æ”¹è¿›è¯ä¹¦ç”Ÿæˆç¨³å®šæ€§ï¼Œé¿å…æ¶æ„ç›¸å…³çš„å´©æºƒ
- âš¡ ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯è¾“å‡º
- âš¡ å¢å¼ºå¤šå¹³å°å…¼å®¹æ€§

**éƒ¨ç½²æˆæœ**:

- ğŸ‰ æˆåŠŸä¿®å¤ `your.domain.com` æ³›åŸŸåè¯ä¹¦ç”Ÿæˆï¼ˆè…¾è®¯äº‘ DNSï¼‰
- ğŸ‰ æˆåŠŸä¿®å¤ `example-site.com` æ³›åŸŸåè¯ä¹¦ç”Ÿæˆï¼ˆé˜¿é‡Œäº‘ DNSï¼‰
- ğŸ‰ è§£å†³äº†è·¨æ¶æ„å¹³å°çš„ SSL è¯ä¹¦ç”Ÿæˆé—®é¢˜

**æ•…éšœæ’é™¤æŒ‡å—**:

```bash
# å¦‚æœåœ¨ARM64 Macä¸Šé‡åˆ°"Illegal instruction"é”™è¯¯
# æ–¹æ¡ˆ1ï¼šä½¿ç”¨RSAå¯†é’¥ï¼ˆæ¨èï¼‰
export ACME_KEY_TYPE=rsa
docker exec acme-ssl-manager /scripts/cert-manager.sh generate 'your-domain.com'

# æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨æŒ‡å®šRSAå¯†é’¥
docker exec acme-ssl-manager bash -c '
export DP_Id="your_id" &&
export DP_Key="your_key" &&
acme.sh --issue --dns dns_dp -d your-domain.com -d *.your-domain.com --keylength 2048'

# æ£€æŸ¥ç”Ÿæˆçš„è¯ä¹¦
docker exec acme-ssl-manager openssl x509 -in /data/certs/your-domain.com/your-domain.com.cer -text -noout | grep -A 2 "Subject Alternative Name"
```

### v1.1.0 (2025-07-13)

**æ–°å¢ç‰¹æ€§**:

- âœ… æ”¯æŒ ECC è¯ä¹¦è‡ªåŠ¨æ£€æµ‹å’Œç®¡ç†
- âœ… æ™ºèƒ½æ—¥æœŸæ ¼å¼è§£æï¼Œå…¼å®¹ BusyBox ç¯å¢ƒ
- âœ… å¢å¼ºçš„é”™è¯¯å®¹é”™æœºåˆ¶
- âœ… ä¼˜åŒ–çš„ `status-all` å‘½ä»¤ï¼Œç¡®ä¿æ‰€æœ‰åŸŸåè¢«æ£€æŸ¥
- âœ… æ–°å¢ your.domain.com æ³›åŸŸåè¯ä¹¦éƒ¨ç½²æ¡ˆä¾‹

**ä¿®å¤é—®é¢˜**:

- ğŸ› ä¿®å¤è¯ä¹¦è·¯å¾„æ£€æµ‹é—®é¢˜ï¼ˆECC vs RSAï¼‰
- ğŸ› ä¿®å¤æ—¥æœŸæ ¼å¼è§£æé”™è¯¯
- ğŸ› ä¿®å¤ `status-all` å‘½ä»¤è¢«ä¸­æ–­çš„é—®é¢˜
- ğŸ› ä¿®å¤ Docker å®¹å™¨æŒ‚è½½è·¯å¾„æ··æ·†é—®é¢˜

**æ€§èƒ½ä¼˜åŒ–**:

- âš¡ æ”¹è¿›è¯ä¹¦çŠ¶æ€æ£€æŸ¥é€»è¾‘
- âš¡ ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âš¡ å¢å¼ºç³»ç»Ÿç¨³å®šæ€§

**éƒ¨ç½²æˆæœ**:

- ğŸ‰ æˆåŠŸéƒ¨ç½² your.domain.com æ³›åŸŸåè¯ä¹¦åˆ° ip æœåŠ¡å™¨
- ğŸ‰ è§£å†³è…¾è®¯äº‘ DNS API é…ç½®é—®é¢˜
- ğŸ‰ å®Œå–„ Docker æŒ‚è½½è·¯å¾„éƒ¨ç½²æµç¨‹

### v1.0.0 (2025-07-12)

**é¦–æ¬¡å‘å¸ƒ**:

- ğŸ‰ å®Œæ•´çš„ SSL è¯ä¹¦è‡ªåŠ¨åŒ–ç®¡ç†ç³»ç»Ÿ
- ğŸ‰ å¤š DNS æä¾›å•†æ”¯æŒ
- ğŸ‰ è‡ªåŠ¨ç»­æœŸå’Œéƒ¨ç½²åŠŸèƒ½
- ğŸ‰ Web ç®¡ç†ç•Œé¢å’Œç›‘æ§é¢æ¿

### è…¾è®¯äº‘ DNS - your.domain.com æ³›åŸŸåè¯ä¹¦éƒ¨ç½²å®ä¾‹

ä»¥ `your.domain.com` æ³›åŸŸåè¯ä¹¦ä¸ºä¾‹ï¼Œæ¼”ç¤ºè…¾è®¯äº‘ DNS çš„å®Œæ•´éƒ¨ç½²æµç¨‹ï¼š

#### æ­¥éª¤ 1ï¼šDNS é…ç½®éªŒè¯

**DNS é…ç½®**ï¼š

```yaml
domains:
  - domain: your.domain.com
    subdomains:
      - www.your.domain.com
      - admin.your.domain.com
    wildcard: true
    dns_provider: tencent
    servers:
      - server_190_164
    cert_type: wildcard
    auto_renew: true
    renew_before_days: 30
    description: "GYLå¹³å°SSLè¯ä¹¦"
```

**æœåŠ¡å™¨é…ç½®**ï¼š

```yaml
servers:
  - server_id: server_190_164
    host: ip
    user: root
    ssl_cert_dir: /opt/docker/nginx/ssl
    nginx_container: nginx
    nginx_reload_cmd: docker restart nginx
```

#### æ­¥éª¤ 2ï¼šç”Ÿæˆè¯ä¹¦

```bash
# ä½¿ç”¨è…¾è®¯äº‘DNSç”Ÿæˆæ³›åŸŸåè¯ä¹¦
docker exec acme-ssl-manager bash -c '
export DP_Id="your_tencent_secret_id" &&
export DP_Key="your_tencent_secret_key" &&
/scripts/cert-manager.sh generate your.domain.com'
```

#### æ­¥éª¤ 3ï¼šæ‰‹åŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨

```bash
# 1. æµ‹è¯•SSHè¿æ¥
docker exec acme-ssl-manager ssh root@ip "echo 'SSHè¿æ¥æˆåŠŸ'"

# 2. åˆ›å»ºè¯ä¹¦ç›®å½•ï¼ˆæ³¨æ„ï¼šä½¿ç”¨æŒ‚è½½è·¯å¾„ï¼‰
docker exec acme-ssl-manager ssh root@ip "mkdir -p /opt/docker/nginx/ssl/your.domain.com"

# 3. å¤‡ä»½ç°æœ‰è¯ä¹¦
docker exec acme-ssl-manager ssh root@ip "
cd /opt/docker/nginx/ssl/your.domain.com/
if [ -f your.domain.com.cer ]; then
  backup_time=$(date +%Y%m%d%H%M%S)
  cp your.domain.com.cer your.domain.com.cer.backup.$backup_time
  cp your.domain.com.key your.domain.com.key.backup.$backup_time
fi"

# 4. ä¸Šä¼ æ–°è¯ä¹¦
docker exec acme-ssl-manager scp /data/certs/your.domain.com_ecc/fullchain.cer root@ip:/opt/docker/nginx/ssl/your.domain.com/your.domain.com.cer
docker exec acme-ssl-manager scp /data/certs/your.domain.com_ecc/your.domain.com.key root@ip:/opt/docker/nginx/ssl/your.domain.com/your.domain.com.key

# 5. è®¾ç½®æƒé™
docker exec acme-ssl-manager ssh root@ip "
cd /opt/docker/nginx/ssl/your.domain.com/
chmod 644 your.domain.com.cer
chmod 600 your.domain.com.key"

# 6. é‡æ–°åŠ è½½nginx
docker exec acme-ssl-manager ssh root@ip "docker exec nginx nginx -s reload"
```

#### æ­¥éª¤ 4ï¼šéªŒè¯éƒ¨ç½²

```bash
# éªŒè¯è¯ä¹¦ä¿¡æ¯
docker exec acme-ssl-manager ssh root@ip "echo | openssl s_client -connect your.domain.com:443 -servername your.domain.com 2>/dev/null | openssl x509 -noout -subject -dates"

# æµ‹è¯•HTTPSè¿æ¥
docker exec acme-ssl-manager ssh root@ip "curl -I -k https://your.domain.com --connect-timeout 10"

# æ£€æŸ¥è¯ä¹¦ç®¡ç†ç³»ç»ŸçŠ¶æ€
docker exec acme-ssl-manager /scripts/cert-manager.sh status your.domain.com
```

**éƒ¨ç½²ç»“æœ**ï¼š

- âœ… æ³›åŸŸåè¯ä¹¦ï¼š`*.your.domain.com` å’Œ `your.domain.com`
- âœ… è¿‡æœŸæ—¶é—´ï¼š2025 å¹´ 10 æœˆ 10 æ—¥
- âœ… HTTPS è¿æ¥æ­£å¸¸
- âœ… ECC ç®—æ³•ï¼Œæ€§èƒ½ä¼˜å¼‚

**âš ï¸ é‡è¦æé†’**ï¼š

- ç¡®ä¿è¯ä¹¦ä¸Šä¼ åˆ° nginx å®¹å™¨çš„æŒ‚è½½è·¯å¾„ï¼ˆ`/opt/docker/nginx/ssl/`ï¼‰
- è€Œä¸æ˜¯å®¹å™¨å†…è·¯å¾„ï¼ˆ`/etc/nginx/ssl/`ï¼‰
- æ£€æŸ¥ docker volume æŒ‚è½½é…ç½®ï¼š`docker inspect container_name`

### ARM64 æ¶æ„å…¼å®¹æ€§è§£å†³æ¡ˆä¾‹ (v1.2.0)

#### æ¡ˆä¾‹ 1ï¼šyour.domain.com æ³›åŸŸåè¯ä¹¦ç”Ÿæˆ

**é—®é¢˜èƒŒæ™¯**ï¼š
åœ¨ ARM64 å®¿ä¸»æœºï¼ˆApple Silicon Macï¼‰ä¸Šä¸º `your.domain.com` ç”Ÿæˆ SSL è¯ä¹¦æ—¶é‡åˆ°"Illegal instruction"é”™è¯¯ã€‚

**è§£å†³è¿‡ç¨‹**ï¼š

1. **é—®é¢˜è¯Šæ–­**ï¼š

   ```bash
   # åˆå§‹é”™è¯¯ - ECCå¯†é’¥ç”Ÿæˆå¤±è´¥
   docker exec acme-ssl-manager /scripts/cert-manager.sh generate '*.your.domain.com'
   # é”™è¯¯ï¼šIllegal instruction OpenSSL req -new -sha256 -key
   ```

2. **æ‰‹åŠ¨è§£å†³**ï¼š

   ```bash
   # ä½¿ç”¨RSAå¯†é’¥æˆåŠŸç”Ÿæˆ
   docker exec acme-ssl-manager bash -c '
   export DP_Id="583967" &&
   export DP_Key="ddfdec56413daf3f29921ef0db3bdd4c" &&
   acme.sh --issue --dns dns_dp -d your.domain.com -d *.your.domain.com --keylength 2048'
   ```

3. **éªŒè¯ç»“æœ**ï¼š

   ```bash
   # è¯ä¹¦ç”ŸæˆæˆåŠŸ
   [Tue Jul 15 12:16:19 CST 2025] Cert success.
   [Tue Jul 15 12:16:19 CST 2025] Your cert is in: /data/certs/your.domain.com_ecc/your.domain.com.cer

   # è¯ä¹¦è¦†ç›–éªŒè¯
   DNS:*.your.domain.com, DNS:your.domain.com

   # æœ‰æ•ˆæœŸéªŒè¯
   notBefore=Jul 15 03:17:46 2025 GMT
   notAfter=Oct 13 03:17:45 2025 GMT
   ```

#### æ¡ˆä¾‹ 2ï¼šexample-site.com æ³›åŸŸåè¯ä¹¦ç”Ÿæˆ

**é—®é¢˜èƒŒæ™¯**ï¼š
ä¸º `example-site.com` ç”Ÿæˆ SSL è¯ä¹¦æ—¶é‡åˆ°åŒæ ·çš„æ¶æ„å…¼å®¹æ€§é—®é¢˜ã€‚

**è§£å†³è¿‡ç¨‹**ï¼š

1. **åº”ç”¨ä¿®å¤**ï¼š

   ```bash
   # v1.2.0è‡ªåŠ¨ä½¿ç”¨RSAå¯†é’¥
   docker exec acme-ssl-manager /scripts/cert-manager.sh generate 'example-site.com'
   ```

2. **æ—¥å¿—è¾“å‡º**ï¼š

   ```bash
   [2025-07-15 12:28:56] [INFO] è®¾ç½®ç¯å¢ƒå˜é‡: Ali_Key=your_aliyun_access_key
   [2025-07-15 12:28:56] [INFO] è®¾ç½®ç¯å¢ƒå˜é‡: Ali_Secret=your_aliyun_access_secret
   [2025-07-15 12:28:56] [INFO] ä½¿ç”¨RSA 2048ä½å¯†é’¥ï¼ˆå…¼å®¹æ€§æ›´å¥½ï¼‰
   ```

3. **æˆåŠŸç»“æœ**ï¼š

   ```bash
   # è¯ä¹¦ç”ŸæˆæˆåŠŸ
   [Tue Jul 15 12:26:58 CST 2025] Cert success.
   [Tue Jul 15 12:26:58 CST 2025] Your cert is in: /data/certs/example-site.com/example-site.com.cer

   # è¯ä¹¦è¦†ç›–éªŒè¯
   DNS:*.example-site.com, DNS:example-site.com

   # æœ‰æ•ˆæœŸéªŒè¯
   notBefore=Jul 15 03:28:23 2025 GMT
   notAfter=Oct 13 03:28:22 2025 GMT
   ```

**ä¿®å¤æ•ˆæœ**ï¼š

- âœ… 100% è§£å†³ ARM64 æ¶æ„å…¼å®¹æ€§é—®é¢˜
- âœ… æ”¯æŒè…¾è®¯äº‘ DNS å’Œé˜¿é‡Œäº‘ DNS
- âœ… è‡ªåŠ¨é€‰æ‹©æœ€ä½³å…¼å®¹æ€§å¯†é’¥ç±»å‹
- âœ… ä¿æŒåŸæœ‰åŠŸèƒ½å®Œæ•´æ€§

### å¸¸è§é—®é¢˜è§£å†³

#### ARM64 æ¶æ„å…¼å®¹æ€§é—®é¢˜ (v1.2.0 å·²ä¿®å¤)

**é—®é¢˜ç—‡çŠ¶**ï¼š
åœ¨ ARM64 å®¿ä¸»æœºï¼ˆå¦‚ Apple Silicon Macï¼‰ä¸Šè¿è¡Œ SSL è¯ä¹¦ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œå¯èƒ½é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```bash
[Tue Jul 15 12:25:03 CST 2025] /usr/local/bin/acme.sh: line 1240: 10466 Illegal instruction
[Tue Jul 15 12:25:03 CST 2025] Error creating CSR.
```

**é—®é¢˜åŸå› **ï¼š

- å®¿ä¸»æœºä½¿ç”¨ ARM64 æ¶æ„ï¼ˆApple Silicon Macï¼‰
- Docker å®¹å™¨ä½¿ç”¨ x86_64 æ¶æ„é•œåƒ
- OpenSSL åœ¨ ECC å¯†é’¥ç”Ÿæˆæ—¶å‡ºç°æ¶æ„ä¸å…¼å®¹çš„æŒ‡ä»¤é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **è‡ªåŠ¨è§£å†³ï¼ˆv1.2.0+ï¼‰**ï¼š

   ```bash
   # ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨RSAå¯†é’¥
   docker exec acme-ssl-manager /scripts/cert-manager.sh generate 'your-domain.com'
   ```

2. **æ‰‹åŠ¨æŒ‡å®š RSA å¯†é’¥**ï¼š

   ```bash
   # ä½¿ç”¨RSA 2048ä½å¯†é’¥ä»£æ›¿ECCå¯†é’¥
   docker exec acme-ssl-manager bash -c '
   export DP_Id="your_tencent_secret_id" &&
   export DP_Key="your_tencent_secret_key" &&
   acme.sh --issue --dns dns_dp -d your-domain.com -d *.your-domain.com --keylength 2048'
   ```

3. **ç¯å¢ƒå˜é‡æ§åˆ¶**ï¼š
   ```bash
   # è®¾ç½®å¯†é’¥ç±»å‹
   export ACME_KEY_TYPE=rsa  # ä½¿ç”¨RSAå¯†é’¥
   # æˆ–
   export ACME_KEY_TYPE=ecc  # ä½¿ç”¨ECCå¯†é’¥ï¼ˆå¯èƒ½åœ¨ARM64ä¸Šä¸ç¨³å®šï¼‰
   ```

**éªŒè¯ä¿®å¤**ï¼š

```bash
# æ£€æŸ¥ç”Ÿæˆçš„è¯ä¹¦
docker exec acme-ssl-manager ls -la /data/certs/your-domain.com/
docker exec acme-ssl-manager openssl x509 -in /data/certs/your-domain.com/your-domain.com.cer -text -noout | grep -A 2 "Subject Alternative Name"
```

#### DNS ç¯å¢ƒå˜é‡è®¾ç½®é—®é¢˜ (v1.2.0 å·²ä¿®å¤)

**é—®é¢˜ç—‡çŠ¶**ï¼š
DNS API è®¤è¯å¤±è´¥ï¼Œæ˜¾ç¤ºç±»ä¼¼é”™è¯¯ï¼š

```bash
[Tue Jul 15 11:59:04 CST 2025] You don't specify dnspod api key and key id yet.
[Tue Jul 15 11:59:04 CST 2025] Please create you key and try again.
```

**é—®é¢˜åŸå› **ï¼š

- è„šæœ¬ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ `^[A-Z_]+:` æ— æ³•åŒ¹é…åŒ…å«æ•°å­—çš„ç¯å¢ƒå˜é‡å
- å¦‚ï¼š`DP_Id`ã€`DP_Key`ã€`Ali_Key` ç­‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
v1.2.0 å·²è‡ªåŠ¨ä¿®å¤æ­¤é—®é¢˜ï¼Œç°åœ¨å¯ä»¥æ­£ç¡®è¯†åˆ«æ‰€æœ‰æ ¼å¼çš„ç¯å¢ƒå˜é‡åã€‚

**éªŒè¯ä¿®å¤**ï¼š

```bash
# æŸ¥çœ‹ç¯å¢ƒå˜é‡è®¾ç½®æ—¥å¿—
docker exec acme-ssl-manager /scripts/cert-manager.sh generate 'your-domain.com'
# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# [2025-07-15 12:17:01] [INFO] è®¾ç½®ç¯å¢ƒå˜é‡: DP_Id=583967
# [2025-07-15 12:17:01] [INFO] è®¾ç½®ç¯å¢ƒå˜é‡: DP_Key=ddfdec56413daf3f29921ef0db3bdd4c
```

#### Docker æŒ‚è½½è·¯å¾„é—®é¢˜

å¦‚æœ SSL æµ‹è¯•æ˜¾ç¤ºæ—§è¯ä¹¦ï¼Œæ£€æŸ¥ nginx å®¹å™¨æŒ‚è½½ï¼š

```bash
# æ£€æŸ¥æŒ‚è½½è·¯å¾„
docker inspect nginx-container-name | grep -A 10 -B 5 'ssl'

# ç¡®è®¤ä½¿ç”¨å®¿ä¸»æœºæŒ‚è½½è·¯å¾„ä¸Šä¼ è¯ä¹¦
# ä¾‹å¦‚ï¼š/opt/docker/nginx/ssl/ è€Œä¸æ˜¯ /etc/nginx/ssl/
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬éå¸¸æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼æ— è®ºæ˜¯æŠ¥å‘Š Bugã€æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼Œè¿˜æ˜¯æäº¤ä»£ç æ”¹è¿›ï¼Œéƒ½å°†å¸®åŠ©è¿™ä¸ªé¡¹ç›®å˜å¾—æ›´å¥½ã€‚

### å¦‚ä½•è´¡çŒ®

#### 1. æŠ¥å‘Šé—®é¢˜

å¦‚æœæ‚¨å‘ç°äº† Bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼š

1. æŸ¥çœ‹ [Issues](https://github.com/yourusername/acme-ssl-manager/issues) ç¡®è®¤é—®é¢˜æœªè¢«æŠ¥å‘Š
2. åˆ›å»ºæ–° Issueï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
   - æ¸…æ™°çš„é—®é¢˜æè¿°
   - é‡ç°æ­¥éª¤
   - é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º
   - ç³»ç»Ÿç¯å¢ƒä¿¡æ¯ï¼ˆæ“ä½œç³»ç»Ÿã€Docker ç‰ˆæœ¬ç­‰ï¼‰
   - ç›¸å…³æ—¥å¿—æˆ–æˆªå›¾

#### 2. æäº¤ä»£ç 

**Fork å’Œå…‹éš†é¡¹ç›®**:

```bash
# Fork é¡¹ç›®åˆ°ä½ çš„ GitHub è´¦æˆ·
# ç„¶åå…‹éš†åˆ°æœ¬åœ°
git clone https://github.com/your-username/acme-ssl-manager.git
cd acme-ssl-manager

# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/original-username/acme-ssl-manager.git
```

**åˆ›å»ºåˆ†æ”¯**:

```bash
# ä» main åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/your-feature-name

# æˆ–ä¿®å¤åˆ†æ”¯
git checkout -b fix/your-bug-fix
```

**è¿›è¡Œæ›´æ”¹**:

1. ç¼–å†™ä»£ç ï¼Œéµå¾ªé¡¹ç›®ä»£ç é£æ ¼
2. æ·»åŠ æˆ–æ›´æ–°ç›¸å…³æ–‡æ¡£
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

**æäº¤æ›´æ”¹**:

```bash
# æ·»åŠ æ›´æ”¹
git add .

# æäº¤æ›´æ”¹ï¼Œä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
git commit -m "feat: add new DNS provider support for CloudFlare"

# æ¨é€åˆ°ä½ çš„ Fork
git push origin feature/your-feature-name
```

**åˆ›å»º Pull Request**:

1. åœ¨ GitHub ä¸Šè®¿é—®ä½ çš„ Fork
2. ç‚¹å‡» "New Pull Request"
3. é€‰æ‹©ä½ çš„åˆ†æ”¯
4. å¡«å†™ PR æè¿°ï¼š
   - æ›´æ”¹æ¦‚è¿°
   - ç›¸å…³ Issueï¼ˆå¦‚æœ‰ï¼‰
   - æµ‹è¯•æ–¹æ³•
   - æˆªå›¾æˆ–ç¤ºä¾‹ï¼ˆå¦‚é€‚ç”¨ï¼‰

### æäº¤ä¿¡æ¯è§„èŒƒ

æˆ‘ä»¬ä½¿ç”¨ [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

```
<ç±»å‹>[(å¯é€‰èŒƒå›´)]: <æè¿°>

[å¯é€‰æ­£æ–‡]

[å¯é€‰è„šæ³¨]
```

**ç±»å‹**:

- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- `refactor`: ä»£ç é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·é“¾æ›´æ”¹

**ç¤ºä¾‹**:

```bash
feat: add CloudFlare DNS provider support
fix: resolve SSL chain verification issue for WeChat Mini Program
docs: update configuration guide with new examples
```

### ä»£ç é£æ ¼

#### Bash è„šæœ¬

```bash
#!/usr/bin/env bash
# ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
set -euo pipefail

# å‡½æ•°å‘½åä½¿ç”¨è›‡å½¢å‘½åæ³•
function check_certificate_status() {
    local domain="$1"
    # å‡½æ•°å®ç°
}

# ä½¿ç”¨åŒå¼•å·åŒ…è£¹å˜é‡
echo "Domain: ${domain}"

# ä½¿ç”¨ [[ ]] è¿›è¡Œæ¡ä»¶åˆ¤æ–­
if [[ -f "${cert_file}" ]]; then
    echo "Certificate exists"
fi
```

#### Python ä»£ç 

```python
# éµå¾ª PEP 8 è§„èŒƒ
# ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›

def generate_certificate(domain: str, cert_type: str = "wildcard") -> Dict[str, Any]:
    """
    ç”Ÿæˆ SSL è¯ä¹¦

    Args:
        domain: åŸŸå
        cert_type: è¯ä¹¦ç±»å‹ï¼ˆwildcard æˆ– singleï¼‰

    Returns:
        åŒ…å«ç”Ÿæˆç»“æœçš„å­—å…¸
    """
    # å‡½æ•°å®ç°
    pass
```

#### YAML é…ç½®

```yaml
# ä½¿ç”¨ 2 ç©ºæ ¼ç¼©è¿›
# æ·»åŠ æ¸…æ™°çš„æ³¨é‡Š

domains:
  - domain: example.com # ä¸»åŸŸå
    subdomains: # å­åŸŸååˆ—è¡¨
      - api.example.com
    wildcard: true # ä½¿ç”¨æ³›åŸŸåè¯ä¹¦
```

### å¼€å‘ç¯å¢ƒè®¾ç½®

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/acme-ssl-manager.git
cd acme-ssl-manager/acme

# 2. å¤åˆ¶é…ç½®æ–‡ä»¶
cp config/*.example config/

# 3. å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# 5. è¿è¡Œæµ‹è¯•ï¼ˆå¦‚æœ‰ï¼‰
docker exec acme-ssl-manager /scripts/test-runner.sh
```

### æµ‹è¯•

åœ¨æäº¤ PR å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. **åŠŸèƒ½æµ‹è¯•**: æ‰€æœ‰æ–°åŠŸèƒ½éƒ½ç»è¿‡æµ‹è¯•
2. **å›å½’æµ‹è¯•**: ç°æœ‰åŠŸèƒ½æœªè¢«ç ´å
3. **è¾¹ç•Œæµ‹è¯•**: æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µ
4. **æ–‡æ¡£æ›´æ–°**: ç›¸å…³æ–‡æ¡£å·²æ›´æ–°

### ä»£ç å®¡æŸ¥

æ‰€æœ‰ PR éƒ½éœ€è¦ç»è¿‡ä»£ç å®¡æŸ¥ï¼š

- è‡³å°‘ä¸€ä½ç»´æŠ¤è€…çš„æ‰¹å‡†
- æ‰€æœ‰è®¨è®ºå·²è§£å†³
- CI æ£€æŸ¥é€šè¿‡
- æ— åˆå¹¶å†²çª

### ç¤¾åŒºå‡†åˆ™

- **å°Šé‡**: å°Šé‡æ‰€æœ‰è´¡çŒ®è€…
- **åŒ…å®¹**: æ¬¢è¿ä¸åŒèƒŒæ™¯çš„è´¡çŒ®è€…
- **å»ºè®¾æ€§**: æä¾›å»ºè®¾æ€§çš„åé¦ˆ
- **ä¸“ä¸š**: ä¿æŒä¸“ä¸šå’Œå‹å–„çš„æ€åº¦

### è·å–å¸®åŠ©

å¦‚æœæ‚¨åœ¨è´¡çŒ®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

- æŸ¥çœ‹ [æ–‡æ¡£](README.md)
- æœç´¢ç°æœ‰ [Issues](https://github.com/yourusername/acme-ssl-manager/issues)
- åœ¨ [Discussions](https://github.com/yourusername/acme-ssl-manager/discussions) æé—®
- è”ç³»ç»´æŠ¤è€…

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License** å¼€æºåè®®ã€‚

### MIT License

```
MIT License

Copyright (c) 2025 ä¼šå‹‡ (Huiyong Wang). All rights reserved.

CertHubâ„¢ - Enterprise SSL Certificate Automation Platform
Author: ä¼šå‹‡ç¦¾å£ç‹ (Huiyong Wang)
GitHub: @huiyonghkw

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

### è®¸å¯è¯è¯´æ˜

MIT License æ˜¯ä¸€ä¸ªå®½æ¾çš„å¼€æºè®¸å¯è¯ï¼Œå…è®¸æ‚¨ï¼š

#### âœ… å¯ä»¥åšçš„äº‹

- **å•†ä¸šä½¿ç”¨**: å¯ç”¨äºå•†ä¸šé¡¹ç›®
- **ä¿®æ”¹**: å¯ä»¥ä¿®æ”¹æºä»£ç 
- **åˆ†å‘**: å¯ä»¥åˆ†å‘åŸå§‹æˆ–ä¿®æ”¹åçš„ä»£ç 
- **ç§äººä½¿ç”¨**: å¯ç”¨äºç§äººé¡¹ç›®
- **ä¸“åˆ©æˆæƒ**: æ˜ç¡®æˆäºˆä¸“åˆ©ä½¿ç”¨æƒ

#### âš ï¸ å¿…é¡»åšçš„äº‹

- **ç‰ˆæƒå£°æ˜**: åœ¨æ‰€æœ‰å‰¯æœ¬ä¸­åŒ…å«ç‰ˆæƒå£°æ˜å’Œè®¸å¯è¯
- **è®¸å¯è¯å‰¯æœ¬**: åŒ…å«å®Œæ•´çš„è®¸å¯è¯æ–‡æœ¬

#### âŒ ä¸æä¾›çš„å†…å®¹

- **è´£ä»»**: è½¯ä»¶æŒ‰"åŸæ ·"æä¾›ï¼Œä¸æä¾›ä»»ä½•ä¿è¯
- **æ‹…ä¿**: ä¸å¯¹è½¯ä»¶çš„è´¨é‡æˆ–é€‚ç”¨æ€§æä¾›æ‹…ä¿

### ç¬¬ä¸‰æ–¹ä¾èµ–

æœ¬é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹å¼€æºè½¯ä»¶ï¼š

| è½¯ä»¶                                                  | ç‰ˆæœ¬   | è®¸å¯è¯       | ç”¨é€”            |
| ----------------------------------------------------- | ------ | ------------ | --------------- |
| [acme.sh](https://github.com/acmesh-official/acme.sh) | Latest | GPL-3.0      | ACME åè®®å®¢æˆ·ç«¯ |
| [Alpine Linux](https://alpinelinux.org/)              | 3.18   | MIT          | å®¹å™¨åŸºç¡€é•œåƒ    |
| [Flask](https://flask.palletsprojects.com/)           | 2.x    | BSD-3-Clause | Web API æ¡†æ¶    |
| [Docker](https://www.docker.com/)                     | Latest | Apache-2.0   | å®¹å™¨åŒ–å¹³å°      |
| [Prometheus](https://prometheus.io/)                  | Latest | Apache-2.0   | ç›‘æ§ç³»ç»Ÿ        |

### è‡´è°¢

ç‰¹åˆ«æ„Ÿè°¢ï¼š

- [acme.sh](https://github.com/acmesh-official/acme.sh) é¡¹ç›®æä¾›çš„ ACME å®¢æˆ·ç«¯
- [Let's Encrypt](https://letsencrypt.org/) æä¾›å…è´¹çš„ SSL è¯ä¹¦æœåŠ¡
- æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…

### å…è´£å£°æ˜

- æœ¬è½¯ä»¶æŒ‰"åŸæ ·"æä¾›ï¼Œä¸æä¾›ä»»ä½•æ˜ç¤ºæˆ–æš—ç¤ºçš„ä¿è¯
- ä½¿ç”¨æœ¬è½¯ä»¶äº§ç”Ÿçš„ä»»ä½•é£é™©ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…
- ä½œè€…å’Œè´¡çŒ®è€…ä¸å¯¹å› ä½¿ç”¨æœ¬è½¯ä»¶é€ æˆçš„ä»»ä½•æŸå¤±è´Ÿè´£

### è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: [https://github.com/huiyonghkw/CertHub](https://github.com/huiyonghkw/CertHub)
- **é—®é¢˜åé¦ˆ**: [https://github.com/huiyonghkw/CertHub/issues](https://github.com/huiyonghkw/CertHub/issues)
- **è®¨è®ºäº¤æµ**: [https://github.com/huiyonghkw/CertHub/discussions](https://github.com/huiyonghkw/CertHub/discussions)
- **ä½œè€…ä¸»é¡µ**: [https://github.com/huiyonghkw](https://github.com/huiyonghkw)

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼ â­**

---

**CertHubâ„¢** - Enterprise SSL Certificate Automation Platform

Made with â¤ï¸ by ä¼šå‹‡ (Huiyong Wang) | [@huiyonghkw](https://github.com/huiyonghkw)

Copyright Â© 2025 Huiyong Wang. All rights reserved.

[è¿”å›é¡¶éƒ¨](#certhub---enterprise-ssl-certificate-automation-platform)

</div>
